# 报告并根据您的调查结果采取行动

渗透测试报告非常重要，因为它们向客户提供了测试的详细结果。在本章中，您将能够理解渗透测试报告的具体内容。您将能够确定报告的受众以及他们对报告的不同看法。您将学习如何使用 Dradis，它可以帮助您跟踪可以在报告中使用的发现、问题和证据。您将了解建议采取何种补救措施来帮助客户保护其环境。

随着本章的学习，您将了解以下主题：

*   渗透测试报告的重要性
*   渗透测试报告包含哪些内容？
*   撰写报告的工具
*   建议补救办法

# 技术要求

本章需要以下技术要求：

*   Kali Linux 2019.1

# 渗透测试报告的重要性

不要低估报告的重要性。渗透测试报告是您讲述在目标组织中导航并发现漏洞的故事的一种方式。它允许您将重要信息传达给利益相关者，如高管和 It 管理团队。这将有助于他们推动补救工作，并为可能需要创建或更新以解决发现的风险的任何政策提供执行支持。请记住，在信息安全方面，如果没有高管持股人的支持，政策注定会失败。

对于技术团队来说，该报告清楚地说明了他们的环境是多么脆弱。它将向他们提供关于什么是易受攻击的、为什么易受攻击、它将影响谁以及如何利用该漏洞的完整技术细节。掌握这些信息将有助于技术团队制定补救措施的路线图，并计划首先解决哪些问题。

不要因为没有足够的时间来写一份像样的报告而陷入困境，确保你在计划中考虑到报告的编写。

当你写报告时，不要假设阅读报告的人拥有与你相同的技术水平。他们在 IT 行业工作，但他们的兴趣可能与你的大不相同。学习如何在报告中解释你的发现是一门艺术；这是一门艺术，随着你在这一领域的成长和经验的积累，你将掌握它。最终，您希望您的报告有助于与您的客户建立关系，然后客户将反复使用您的服务。

# 渗透测试报告包含哪些内容？

有些客户可能会在报告中准确地告诉你他们想要什么，而有些客户不会。在任何情况下，您都应该有一个报告将遵循的基本结构。这里讨论的结构绝不是一个模板；这仅仅是为了帮助你理解报告中的内容。如果您为与其他组织联系以执行渗透测试的组织工作，他们可能有自己的模板。如果您作为个人执行渗透测试，您将构建自己的模板。

让我们看看报表可以包含的一些部分。

# 封面

封面应包含渗透测试公司的名称和徽标等信息。应显示客户的姓名以及为渗透测试提供的任何标题。这将在为同一客户执行多个测试时提供清晰的分离。此页面上应显示日期以及文档的分类。报告中包含的细节是敏感的，不应供所有人查看；因此，应使用**机密**或**高度机密**等分类。

# 执行摘要

执行摘要将在高层传达渗透测试的具体目标和结果。本节的听众将是负责战略愿景、安全计划和组织监督的人员。本节通常包含子节，我们现在将对其进行描述。

# 出身背景

在本节中，您需要定义测试的目的。确保将参与前阶段讨论的细节联系起来，以便读者能够将风险、对策或测试目标等方面与测试的目标和结果联系起来。

您还可以在本节中列出参与过程中可能发生变化的任何目标。

# 整体姿态

在此，您将说明渗透测试的整体姿势。您将说明渗透测试的有效性以及测试期间实现的目标。在本节中，您可以说明它对组织的潜在影响。

# 风险等级

本节将定义组织的总体风险等级。您将使用一种计分机制，该机制应在交战前阶段达成一致。

一个例子是**潜在损害**、**再现性**、**可利用性**、**受影响用户**和**可发现性**模型（**恐惧**。每个方面可定义如下：

*   **潜在损害**：资产受到的影响如何？
*   **再现性**：攻击的再现性有多容易？
*   **可利用性**：资产的可利用性如何？
*   **受影响用户**：有多少用户受到影响？
*   **可发现性**：发现漏洞的容易程度如何？

通过回答这些问题，您将为发现的每个项目分配一个风险评级值。这可以是**高**、**中**或**低**。风险评级值可以是用数字表示的简单值，例如，低=1、中=2 和高=3。

将所有值相加将确定风险评级：

| **风险等级** | **结果** |
| 高的 | 12 - 15 |
| 中等的 | 8 -11 |
| 低的 | 5 - 7 |

对发现使用恐惧模型的示例如下：

**发现的漏洞**：缺乏输入安全性使得能够使用 SQL 注入攻击从 SQL 数据库提取用户详细信息。

分析恐惧模型中项目的评级将确定风险评级：

| **项目** | **评级** |
| 损伤潜能 | 3. |
| 再现性 | 2. |
| 可利用性 | 3. |
| 受影响用户 | 3. |
| 可发现性 | 1. |

将所有值相加后，总和为 12，这意味着风险评级较高。

# 一般调查结果

在本节中，将向您提供调查结果的总体视图。这不是具体的详细调查结果，而是调查结果的统计表示。您可以使用图形或图表来查看，这些图形或图表将表示已测试的目标、结果、攻击场景以及在交战前阶段定义的其他指标。您可以使用表示问题原因的图表，例如，缺少操作系统强化=35%，等等。

这里也可以列出对策的有效性。例如，在测试具有 web 应用程序防火墙的 web 应用程序时，您可能会声明五分之二的攻击已被防火墙阻止。

# 战略路线图

路线图提供了优先修复计划。必须根据业务目标和影响程度权衡这些因素。理想情况下，此部分应与组织定义的目标对应。

路线图可分为短期、中期和长期活动。短期将定义组织在 1-3 个月内可以做些什么来解决已发现的问题。中期可能是 3-6 个月，而长期可能是 6-12 个月。

# 技术报告

在技术报告中，您将围绕您发现的发现传达所有技术细节。本节将详细描述审计业务的范围。本节的观众将是具有深厚技术技能的人员，他们可能是对调查结果进行补救的人员。

技术报告的第一部分是导言部分。本节将包含以下主题：渗透测试涉及的人员、联系信息、目标系统或应用程序、目标和范围。

让我们关注技术报告中的主要主题。

# 使用的工具

在某些情况下，您的客户可能希望复制您执行的测试。为了让他们获得相同的结果，最好公开您使用的工具及其版本。

这方面的一个例子如下：

*   **测试平台**：Kali Linux 2019.1
*   **Metasploit 框架 v5**：渗透测试框架
*   **Burp Suite Professional v1.7.34**：Web 应用程序测试框架
*   **Nmap v7.70**：端口扫描和枚举工具

您将继续列出渗透测试期间使用的所有工具。

# 信息收集

在本节中，您将写下可以获得多少有关客户的信息。确保突出显示公共和私人信息的范围。如果需要，您可以将此部分分为两类：

*   **被动信息采集**：此部分显示在不向目标发送任何数据的情况下采集的信息量。例如，您可以突出显示从精心编制的 Google dork、DNS 或可公开访问的文档中获取的任何信息。
*   **主动信息收集**：在本节中，您将展示使用端口扫描和其他脚印活动等技术获得的信息量。本节披露了通过直接向资产发送数据而获得的数据。

公开可访问的信息对于任何组织来说都应该是一个巨大的问题，特别是如果公开可访问的文档中存在任何元数据，这些元数据可能泄露组织的用户名结构。

# 脆弱性评估和利用

在本节中，您将定义用于识别漏洞以及如何利用漏洞的方法。您将包括诸如漏洞分类、漏洞证据和 CVE 详细信息等内容。

披露漏洞时，请确保将其分为技术漏洞和逻辑漏洞。

技术漏洞是指缺失补丁、编码错误或可能注入恶意代码（例如 SQL 注入攻击）的漏洞。

通过发现应用程序工作方式中的缺陷（例如，未能执行权限检查的 web 应用程序），可以利用逻辑漏洞。

以下是如何报告漏洞的示例：

*   **发现**：在这里，您将详细讨论该发现。例如：我们发现 Server01（`192.168.10.15`）缺少 MS17-010 Microsoft Windows 修补程序，该服务器已被 DoublePulsar 手动攻击。DoublePulsar 创建了一个任何人都可以使用的系统后门。它为 WannaCry 和 NotPetya 等勒索软件打开了大门，特别是在没有 MS17-010 补丁的系统上。我们能够利用此缺失的修补程序获得对服务器的完全管理权限。因为我们可以访问服务器，所以我们能够使用 Metasploit 的 hashdump 提取本地管理员帐户（`localadmin`及其密码散列。
*   **受影响主机**：在这里定义主机或应用程序的全名，例如`CLIENT\Server01`（主机名）。
*   **使用的工具**：在这里，您将解释您使用的工具，例如 Metasploit Framework v5。
*   **证据**：您将在此处提供利用漏洞的证据。它可以是屏幕截图或屏幕文本捕获的形式。
*   **业务影响**：在本节中，您定义了发现的风险。例如，如果系统未及时修补，可能会带来风险，恶意软件、勒索软件和恶意用户可能会滥用这些风险来访问敏感信息。

*   **根本原因**：定义漏洞的原因。这可能是技术性的，例如缺少安全补丁或与流程相关。例如，根本原因与流程相关，因为存在修补程序管理系统。服务器未及时修补。
*   **建议**：在这里，您将定义补救这一发现的建议行动方案。确保提供尽可能多的细节。例如，短期操作是更新服务器，以确保它与所有 Microsoft 修补程序都是最新的。长期行动将是确保每月对整个网络进行漏洞评估，并确保服务器和工作站完全修补。管理层还应扫描网络中所有已被 DoublePulsar 手动利用的系统，并将其从网络中删除，因为它们创建了系统的后门供任何人使用。

在报告中获得正确的详细程度可能很棘手。有些客户可能会发现报告过于详细，而有些客户可能会发现报告不够详细。确定报告中应包含的适当详细信息量的最佳方法是花时间与客户交流，了解他们的期望以及他们希望从报告中得到什么。

# 剥削后

一旦讨论了漏洞及其利用，您需要强调对客户机的实际影响。请记住，这种影响将是客户端在实际攻击中的体验。

在本节中，您可以使用屏幕截图详细说明影响的程度。您将在本节中讨论的一些主题如下：

*   例如，权限提升路径和使用的技术通过了散列攻击，最终伪造了一张金票
*   使用持久性维护访问的能力
*   过滤数据的能力
*   可能已使用轴心点访问的其他系统

本节将讨论对策的有效性，包括主动和被动对策。探测能力也属于这一部分；例如，防病毒软件是否能够检测到您的有效负载

如果渗透测试期间触发了任何事件响应活动，则应在本节中列出。

# 结论

结论将包含渗透试验的最终概述。在本节中，您可以重复测试的部分内容，以及客户机如何提高其安全性。无论结果如何糟糕，总是以积极的态度结束。这将为您的客户提供信心，使他们能够在未来的测试活动不断增长时执行这些活动。

# 撰写报告的工具

当涉及到编写渗透测试报告时，您可能想知道如何跟踪发现。也许你更喜欢使用文字处理器的手动方法，或者你想要更直观的东西。

Kali Linux 包括一个名为 Dradis 的工具，这是一个开放源代码框架，安全专业人员使用它来实现有效的信息共享。Dradis 有社区版和专业版。Kali Linux 包含社区版。professional edition 包含一些有趣的功能，例如自定义品牌、2FA、一键式报告以及导出到多种文件类型的功能。但是，社区版包含专业版的核心功能，允许您以 HTML 或 CSV 格式导出结果。

可通过应用程序|报告工具访问 Dradis：

![](assets/467fda84-c405-44ee-b0da-41ee8a1434f8.png)

图 1：访问 Dradis

首次运行 Dradis 时，系统将提示您创建共享服务器密码和新用户帐户。完成后，您将登录到 Dradis 的主登录页。

# 方法论

在 Dradis 中，有一个称为方法论的部分。这是要为给定项目执行的任务列表。您可以创建自己的方法或导入现有方法：

![](assets/af806cbc-8f48-46a2-a5c7-b503ef40ed20.png)

图 2:Dradis 的方法学组件

如果您单击 AddNew 并选择 DownloadMore，您将被重定向到一个可以下载法规遵从性软件包的链接。下载 PTES 技术指南；这将是一个你需要提取的`.zip`文件。在该文件的内容中会有一个名为`ptes_methodology`的文件夹；将这些文件解压缩到`/var/lib/dradis/templates/methodologies`。提取文件后，刷新 Dradis 页面。

现在，您将能够添加各种 PTES 方法。继续并将它们全部添加：

![](assets/cac099f0-d143-46af-89f1-0c8f2a114f4e.png)

图 3：添加 PTES 方法

添加它们之后，请注意输出。您现在有一份可在 PTES 方法学的不同阶段执行的各种任务的清单。这是确保您在执行渗透测试时遵循方法学标准的好方法：

![](assets/e6259f0f-dc71-431b-81f8-4ff022fd1b7f.png)

图 4：根据 PTES 方法的检查表

当然，并不是所有的渗透测试都遵循这种方法。当您执行不同的渗透测试时，您将创建适合客户机的不同方法。

# 节点

节点可以比作文件系统中的文件夹。您将在此处存储注释、附件和证据文件等信息。节点将帮助您组织项目。

要创建节点，请单击节点右侧的加号（+）。从这里，您将添加一个顶级节点。您可以一次添加一个，也可以一次添加全部：

![](assets/3aa37940-f02a-4d57-8584-06d0b662762d.png)

图 5：添加多个节点

创建节点结构后，就可以从其他工具上载文件。在这里，您可以从 Nmap 扫描、Nessus、Nikto 等导入文件：

![](assets/200bee0f-1306-44d9-b96d-1ce8c8216378.png)

图 6：从其他工具上载文件

在下面的屏幕截图中，我上传了一个 Nmap 扫描。Dradis 已填充属性和注释部分以反映扫描结果：

![](assets/ed53e7d8-95c5-449a-965b-7cf3be26cb11.png)

图 7：导入 Dradis 的 Nmap 扫描结果

当您导入各种工具输出时，Dradis 将利用其规则引擎将数据自动填充到节点中。

# 问题和证据

**问题**包含有关问题或漏洞的信息。例如，您可以在这里提供描述、CVE、URL 引用等。

**证据**表明存在问题。例如，您可能会创建利用漏洞的证据。

在创建证据之前，您需要创建一个问题。要创建问题，请单击问题右侧的加号（+）。如果愿意，可以使用模板，但不必这样做。定义将显示证据的问题，如下所示：

![](assets/6a44412c-50d5-4362-8396-28dc04684761.png)

图 8：创建问题

创建问题后，您可以导航到要记录证据的节点，然后单击证据标志。接下来，您将从下拉列表中选择问题，然后写下您的证据：

![](assets/6d165a55-39eb-4e93-b33c-be9aeb80be2f.png)

图 9：创建证据

在节点中，您可以选择上载附件。附件可以是屏幕截图、报告、从目标下载的文件等任何内容。

您可以通过单击项目顶部的“导出结果”链接来浏览项目。

使用 Dradis 确实可以帮助您在执行渗透测试时跟踪您的发现。若您在渗透测试的特定阶段错过了一个步骤，方法论可以作为一个很好的提醒。

# 建议补救办法

在渗透测试报告中，您需要就如何确保发现的结果给出建议。重要的是要了解如何修复这些漏洞，而不是只知道如何利用它们。

让我们考虑一下在这本书中执行的一些攻击和可以被推荐的补救活动。

# 信息收集

在信息收集阶段，我们研究了如何使用公共可访问源（OSIT）收集有关目标的信息。一个组织不可避免地会公开发布信息。防止信息暴露（如文档中的元数据）的关键是使用**信息保护**等技术。信息保护保护数据不受未经授权的使用、披露、访问、破坏、中断和修改。信息保护利用一些技术（如加密、数据分类、策略和过程）来保护信息。

防止主动信息收集需要保护不应打开的端口。还可以使用网络层防御，例如交换机上的访问控制列表和防火墙来执行过滤。

# 社会工程

社会工程可能是攻击者可用的最危险的攻击载体之一。成功的社会工程攻击取决于攻击者能够获得的信息量。类似地，在渗透测试中，成功的社会工程攻击将取决于您能够获得多少有关目标组织的信息。

在防范社会工程方面，没有什么灵丹妙药。归根结底，是我们的人性左右着我们，使我们成为这类袭击的受害者。但是，组织可以采取以下措施：

*   **教育**：提供最终用户教育对任何组织都至关重要。如果用户不知道如何识别社会工程攻击，他们怎么会不会成为这些攻击的受害者？教育的关键是让最终用户关心安全。
*   **意识**：组织需要意识到什么类型的信息是公开的。这种类型的信息是攻击者将首先访问的。如果信息披露的内容太多，很容易造成社会工程攻击，那么组织需要解决这一问题。

*   **身份验证**：组织需要寻找多种识别用户的方法。例如，当用户通过自助门户请求密码重置时，应该有某种类型的双因素身份验证。
*   **技术**：许多组织正在将电子邮件移动到 Office 365 等云服务。在 Office 365 中，有大量安全机制可用于防范复杂的网络钓鱼攻击。大多数情况下，组织并没有完全意识到存在的防御，或者他们可能没有正确地调整它们。

社会工程对一个组织来说是非常危险的。这一切都归结为可以用来对付一个组织的可用信息量。如果社会工程是渗透测试中的一个攻击向量，确保你能准确地说出你有多少信息可以成功地发动攻击。这将有助于本组织了解其弱点并加以解决。

# 漏洞和操作系统强化

软件不太可能没有 bug，因此漏洞总是存在的。这在操作系统等大型软件中表现得很明显。操作系统是复杂的，有许多组件协同工作。只要一个组件中有一个缺陷，就可以利用系统。

构建软件的组织通常遵循**软件开发生命周期**（**SDLC**）。它是一个框架，定义了如何开发、维护和更换软件的详细步骤。安全性现在被包含在软件生命周期中，因此可以构建安全的软件。这大大减少了代码中发现的错误数量，这些错误可能导致漏洞，但这并不能完全消除编码错误的风险。

这就是补丁管理发挥作用的地方。遵守适当的补丁管理流程将大大减少与组织使用的软件相关的漏洞数量。

操作系统强化是确保已知易受攻击的不安全协议不被利用的另一种好方法。例如，SMBv1 的缺陷是已知的，很容易被利用。**互联网安全中心**（**CIS**）拥有大量基准测试库，并讨论如何强化各种系统。CIS 基准可在此处找到：[https://www.cisecurity.org/cis-benchmarks/](https://www.cisecurity.org/cis-benchmarks/) 。

Microsoft 维护适用于其产品套件的安全基线。这些产品在实现其产品中的特定安全功能方面非常出色。这些基线可在此处找到：[https://blogs.technet.microsoft.com/secguide/](https://blogs.technet.microsoft.com/secguide/) 。

# 密码

基于密码的攻击是目前仍在使用的最简单、最古老的攻击形式。如今，企业已经意识到拥有强大密码的价值，但归根结底还是可用性。例如，强制使用 12 个字符的密码很容易，但最终用户会如何反应？他们很可能会使用像`January@1234`这样的常用密码，并将其增加数月，或者他们可能会拥有一个真正安全的密码，并最终将其记下或存储在某个地方。密码的另一个陷阱是人们倾向于重用密码。例如，他们的域密码可能与 Facebook 上使用的相同。

保护密码将需要使用不仅仅是密码的身份验证。在这个时代，多因素认证是必须的。利用额外的身份验证方法（如令牌、SMS 或电话）可以增加额外的保护层。将多因素身份验证与密码最佳实践（如强制执行复杂性、更高的密码长度和强制执行禁止的密码列表）相结合将提高安全性。

# Web 应用程序

Web 应用程序是攻击者的主要目标，因为它们面向公众。它们可以作为网络的入口点，特别是当 web 应用程序服务器没有从网络层正确划分时。

**开放式 Web 应用程序安全项目**（**OWASP**）维护了一个名为**OWASP Top 10**的列表。此前 10 名列表讨论了 10 个最关键的 web 应用程序安全风险及其缓解措施。它详细解释了攻击及其影响，并提供了攻击场景的参考。OWASP 前 10 名可在此处找到：[https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project](https://www.owasp.org/index.php/Category:OWASP_Top_Ten_Project) 。

在寻找 web 应用程序攻击预防时，另一个很好的资源是 OWASP 攻击类别，可在此处找到：[https://www.owasp.org/index.php/Category:Attack](https://www.owasp.org/index.php/Category:Attack) 。

# 特权升级和横向移动

横向移动是网络中最常见的攻击之一。在环境中漫游的能力为攻击者提供了一个广阔的环境，可以通过浏览来检测高权限帐户。

最容易用于横向移动的帐户之一是**本地管理员**帐户。通常，此帐户共享相同的名称和密码，这意味着如果您在一台计算机上泄露此帐户，则可以在另一台计算机上轻松地重复使用此帐户。解决这一问题需要在网络中强制使用随机的本地管理员帐户密码。在 Windows 环境中，这可以使用**本地管理员密码解决方案**（**LAPS**来完成。更多信息可在此处找到：[https://www.microsoft.com/en-us/download/details.aspx?id=46899](https://www.microsoft.com/en-us/download/details.aspx?id=46899) 。

良好的凭证卫生是防止权限升级的关键。它要求不向较低信任度的系统公开高权限帐户，例如，限制在工作站上使用**域管理员**帐户。如果工作站被破坏，**域管理员**帐户的散列可以被转储，游戏结束。在任何环境中，强制执行最小特权原则都应该是一种规范。

# 总结

在本章中，您已经对渗透测试中包含的内容有了很好的理解。现在，您可以创建一份针对管理人员和技术人员的报告。您拥有使用报告工具 Dradis 记录渗透测试结果的实践经验。您已经深入了解了客户端可以部署的各种安全措施，以提高其安全态势。

在下一章（[第 14 章](14.html)*中，我该从这里走到哪里？*，我们将介绍您如何通过查看认证、在线培训资源和实践技能来发展渗透测试领域的职业生涯。

# 问题

1.  渗透测试报告的重要性是什么？
2.  报告的执行部分和技术部分有什么区别？
3.  可以使用什么工具帮助您生成报告？
4.  查找与 web 应用程序攻击和预防相关的信息的好来源是什么？
5.  防止特权升级和横向移动需要做什么？