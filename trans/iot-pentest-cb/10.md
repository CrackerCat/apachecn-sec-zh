# 固定硬件

在本章中，我们将介绍以下配方：

*   硬件最佳实践
*   不常见的螺钉类型
*   抗扰和硬件保护机制
*   侧通道攻击保护
*   暴露接口
*   通信数据加密与 TPM

# 介绍

目前市场上的大多数物联网设备在硬件安全方面都失败了，即保护对硬件的访问免受攻击者的攻击。无论是 IP 摄像头、婴儿监视器、医疗设备、企业物联网、智能可穿戴设备还是智能电视，只要您开始关注其安全性，中等技能的攻击者就很有可能打开设备（由于没有/几乎没有打开设备的保护），读取各种芯片，为他们识别数据表（由于缺少隐藏芯片身份的保护），访问芯片中的数据（当没有保护防止访问芯片时），通过各种接口与设备交互（因为没有保护防止暴露的接口），等等。

在本章中，我们将介绍设备开发商和制造商为保护物联网设备中使用的嵌入式设备硬件可以采取的各种步骤。尽管使设备 100%安全几乎是不可能的，但本章中提到的步骤将有助于确保您所使用的设备遵守非常好的安全态势，这对于攻击者来说是很难突破的。

# 硬件最佳实践

但是，在深入讨论保护硬件所能做的各种事情之前，让我们简短地讨论一下保护嵌入式设备所需要采取的方法。

构建嵌入式设备时需要考虑的一点是，一旦产品上市，大多数基于硬件的漏洞就无法修复。这意味着在使用硬件时，从一开始就需要非常小心。

在为物联网解决方案构建硬件设备时，需要注意的另一件事是，始终考虑攻击者在能够访问硬件时可以访问的资源。这意味着，如果攻击者能够打开物联网设备，那么如果他查看 PCB，他会看到哪些可见组件。此外，如果攻击者更进一步，通过外壳访问硬件接口，他会怎么做。

这些是构建嵌入式设备时应该考虑的一些事情。

以下是嵌入式设备硬件设计和开发过程中应遵循的一些最佳实践：

*   确保您的设备具有防干扰和硬件保护机制
*   逆向工程的复杂性可以通过使用独特的螺钉或使用其他方法将硬件的各个部分组合在一起来提高
*   确保攻击者 UART 和 JTAG 访问硬件的所有常见方式均未公开/存在
*   利用**可信平台模块**（**TPM**保护措施，确保您的设备安全性得到进一步加强

# 不常见的螺钉类型

硬件攻击者的第一步是打开设备，查看 PCB 上的芯片和各种暴露的接口。可以使用不常见的螺钉（难以打开）或使用超声波焊接或高温胶水等方法将多个硬件外壳密封在一起，在一定程度上对其进行保护。

下图显示了一些常见的螺钉类型：

![](Images/58046357-fd8f-4376-aa88-81a65ee5ba16.png)

资料来源：http://thecraftsmanblog.com/wp-content/uploads/2013/09/Screw-Drive-Types.png

如果您决定使用独特/不太常见的设备螺钉，攻击者将更难打开您的设备，在大多数情况下，唯一的选择是将其打开。强制开启，甚至正常开启，都可以通过添加元件来抵抗，这些元件可以感应和检测设备的开启，这将在下一节中讨论。

# 抗扰和硬件保护机制

防篡改是指使用专门的部件来防止对给定设备的篡改。实施防干扰的一种常见且有效的方法，可以加强设备的硬件安全性，是在设备中添加篡改检测开关、传感器或电路，可以检测设备的某些动作，如打开或强行损坏，并将基于此采取行动，删除闪存，或使设备无法使用。

除此之外，强烈建议移除敏感芯片和组件的标签，用环氧树脂将其隐藏，甚至将芯片封装在安全的外壳中，以保护敏感芯片和组件。

实现防篡改的其他一些技术包括采用紧密的气流通道、安全螺钉和硬化钢外壳，所有这些都会使篡改设备变得极其困难。

![](Images/b344f9ba-5298-40c7-bb84-741ba876e442.png)

电源插座上的安全螺丝

大多数设备制造商还实施了一些无效的防篡改保护。以下是 TP 链路 MR3020 的图像，它使用胶水保护和隐藏 UART 端口，但显然没有成功：

![](Images/d49498ab-e7da-4bc9-a4d8-edea1257b40b.png)

在这种情况下，可以使用一把纸刀非常容易地去除胶水，然后将底层 UART 接口暴露出来。

# 侧通道攻击保护

保护硬件安全的一个明显的保护机制是实现和启用加密。然而，存在可以绕过加密或极易获得密钥的攻击。

侧通道攻击是一种先进的硬件攻击技术，在这种技术中，攻击者使用不同的信息源（如功率变化、时序分析、电磁数据变化和声音信息）提取更多信息，这些信息可用于危害目标设备。

**直接内存攻击**（**DMA**）是一种侧通道攻击，它让攻击者直接访问某个活动*功能所涉及的其中一个组件，而不是走通常的路线。例如，以 USB 为例，USB 连接到控制器集线器/**平台控制器集线器**（**PCH**），可以通过**直接内存访问**（**DMA**访问。*

这些攻击很难预防，但是，可以采取以下一些措施来防止此类攻击：

*   使用设备中的组件，可以减少系统外部传递的总体信息（无论是电磁辐射还是声音）。
*   在执行敏感活动时添加额外的干扰，使攻击者更难提取信息。
*   确保攻击者无法对不需要的组件进行任何物理访问。

# 暴露接口

确保物联网设备硬件安全的最重要的事情之一是在设备上市时禁用和删除 UART 和 JTAG 接口，以及硬件中的任何其他诊断功能。

这里的另一个重要考虑因素是，即使没有可见的公开接口，攻击者也可以直接钩住芯片的支脚来访问 UART、JTAG 等。这是通过阅读芯片组的数据表来完成的，找出哪些引脚用于哪些功能，然后进行必要的连接。为了增加一点复杂性，这里可以采取的步骤之一是通过*过孔*使不同层之间的界面加深，而不是暴露在可见层之一上。但是，只有当设备开发人员在以后需要公开的接口时，才应该这样做。在所有其他实际情况下，应移除这些接口。另一个值得注意的安全保护是增加了硬件和软件保险丝，可以防止芯片被读取或写入。

这里需要注意的一点是，基本的保护机制（如切断轨道）效率很低，可以由中等技能的攻击者来解决。

然而，通过使用焊接桥，切割轨道可以连接在一起，以重新启用 JTAG，并使用其他技术进一步利用它。

# 通信数据加密与 TPM

尽管加密是固件安全的一部分，但攻击者通常可以嗅探在两个不同硬件组件之间传递的数据。为确保您的敏感信息不会落入攻击者手中，请确保您对传输中以及静止的数据进行了加密。

在讨论嵌入式设备中的加密时，需要考虑的另一件事是执行某种加密功能所需的资源量。

由于设备资源不足，执行极强的加密是不可行的，因此，应提前考虑加密和可用性之间的良好平衡，并在硬件中实现。

如果可能且芯片支持，则利用 TPM 存储所有各种加密密钥，这还可以提供信任根等功能，防止对启动过程进行修改。大多数胎压监测系统支持有效的硬件随机数生成器，并能够在 200 毫秒内计算 2048 位 RSA 签名。

如果无法实现 TPM 基础安全性，另一种选择是使用复制保护加密狗或**硬件安全模块**（**HSM**，其中将存储加密密钥。这也可以在设备运行期间用于防止攻击，例如固件修改和后门攻击，从而增强设备的安全性。