# 第二章信息收集与脆弱性评估

有一种说法是所有 Windows 系统都很容易被利用。这并不完全正确。几乎任何 Windows 系统都可能被强化到需要很长时间才能利用其漏洞的程度。在本章中，您将学习以下内容：

*   如何在坏人之前发现 Windows 网络并发现漏洞
*   调查和映射 Windows 网络以查找易受攻击的 Windows 系统的方法

在某些情况下，这将增加您对十大安全工具的了解，在其他情况下，我们将向您展示处理此类调查的全新工具。

# 网络足迹

没有一张好地图，你就找不到路。在本章中，我们将学习如何收集网络信息并评估网络上的漏洞。在黑客世界里，这被称为足迹。这是任何正义黑客的第一步。这是你节省时间和大量头痛的地方。没有你的目标，你只是在黑暗中射击。在任何一个好的笔测试工具箱中，最大的工具就是心态。你必须有狙击手的头脑。你学习你的目标习惯和行动。您可以了解目标所在网络上的流量。你发现目标的弱点，然后攻击这些弱点。搜索并摧毁！

为了做好足迹，您必须使用 Kali 附带的几种工具。每个工具都有它的优点，并从不同的角度观察目标。你对目标的看法越多，你的攻击计划就越好。封装外形将根据您的目标是在公共网络上的外部，还是在局域网上的内部而有所不同。我们将涵盖这两个方面。

如果您没有书面许可，在公共网络上对机器进行扫描和使用这些工具属于联邦犯罪。在本书中，对于 Kali Linux 的大多数实例，我们将使用在 VMware 和 Oracle VirtualBox 上运行的虚拟机，它们是为本书专门构建的。我们每天使用的 Kali 实例都是经过大量定制的，只需一本书就可以涵盖这些定制。对于外部网络，我们将使用 Internet 上的几个实时服务器。请尊重并保留这些地址，因为它们位于作者的亚特兰大云技术服务器集群中。

请再次阅读上面的段落，记住我们不允许您攻击这些机器。如果你没有时间，就不要犯罪。

## 使用 Nmap 探索网络

如果不谈论 Nmap，你就不能谈论网络。Nmap 是网络管理员的瑞士军刀。它不仅是一个伟大的足迹工具，而且是任何系统管理员都能获得的最好、最便宜的网络分析工具。它是检查单个服务器以确保端口正常运行的一个很好的工具。它可以对整个网段进行心跳和 ping。当 ICMP（ping）关闭时，它甚至可以发现机器。它可用于压力测试服务。如果机器在负载下冻结，需要修理。

Nmap 是由*戈登·里昂*于 1997 年创建的，他在互联网上使用 Fyodor 的手柄。Fyodor 仍然维护 Nmap，可以从[下载 http://insecure.org](http://insecure.org) 。你也可以在那个网站上订购他的书*Nmap 网络扫描*。这是一本很棒的书，很值这个价！Fyodor 和 Nmap 黑客在他们的网站上收集了大量信息和安全电子邮件列表。因为您有 Kali Linux，所以已经安装了 Nmap 的完整副本！下面是一个针对 Kali Linux 实例运行的 Nmap 示例。从顶部栏上的图标或点击菜单链接**应用程序****附件****终端**打开终端。如果您愿意，您也可以选择**根终端**，但由于您已经以根用户身份登录，因此在终端仿真器的行为方式上看不到任何差异。

在命令提示下键入`nmap -A 10.0.0.4`（您需要输入正在测试的机器的 IP）。输出显示`1000`常用端口中打开的端口。默认情况下，Kali Linux 没有运行的网络服务，因此在这次运行中，您将看到一个读数，显示没有打开的端口。

为了让它更有趣一点，输入`/etc/init.d/apache2 start`启动内置的 Web 服务器。web 服务器启动后，再次运行 Nmap 命令：

```
nmap -A 10.0.0.4 

```

如您所见，Nmap 正在尝试发现操作系统（OS）并告知正在运行的 web 服务器版本：

![Exploring the network with Nmap](../Images/image00684.jpeg)

下面是一个从 Git Bash 应用程序运行 Nmap 的示例，它允许您在 Windows 桌面上运行 Linux 命令。此视图显示了 Nmap 的一个简洁功能。如果您感到无聊或焦虑，并且认为系统扫描时间过长，您可以按下向下箭头键，它将打印一条状态行，告诉您扫描完成的百分比。这与告诉您扫描还剩多少时间不同，但它确实让您了解所做的工作：

![Exploring the network with Nmap](../Images/image00685.jpeg)

## 天马

Nmap 带有一个名为 Zenmap 的 GUI 前端。**Zenmap**是 Nmap 应用程序的友好图形界面。您将在**应用程序****信息收集****Zenmap**下找到 Zenmap。与许多 Windows 工程师一样，您可能更喜欢 Zenmap 而不是 Nmap：

![Zenmap](../Images/image00686.jpeg)

在这里，我们可以在下拉框中看到最常见的扫描列表。Zenmap 的一个很酷的特性是，当您使用按钮设置扫描时，应用程序还会写出命令行版本的命令，这将帮助您了解在命令行模式下使用 Nmap 时使用的命令行标志。

### 提示

**黑客提示**

大多数黑客对 Linux**命令行界面**（**CLI**非常满意。您希望在命令行上学习 Nmap 命令，因为您可以在自动化 Bash 脚本中使用 Nmap，并创建 cron 作业，以使例行扫描更加简单。您可以将 cron 作业设置为在网络较安静的非高峰时间运行测试，并且测试对网络合法用户的影响较小。

选择密集扫描产生`nmap -T4 -A -v`命令行。这个产生一个快速扫描。

*   `T`表示定时（从 1 到 5），默认定时为`-T3`。如果网络正在运行**入侵检测系统**（**IDS**，则计时越快，测试越粗糙，被检测的可能性越大。
*   `-A`代表所有，因此这个单一选项可以让您进行深入的端口扫描，包括操作系统标识，并尝试查找侦听端口的应用程序以及这些应用程序的版本。
*   Finally, the `-v` stands for verbose. `-vv` means very verbose:

    ![Zenmap](../Images/image00687.jpeg)

## 罗嗦造成了不同

接下来的三幅图像显示了详细程度在操作系统扫描中的差异。操作系统扫描包括隐形扫描，因此`nmap -O hostname`与`nmap -sS -O hostname`完全相同。通过使用`-v`选项，您可以选择从 1 到 5 的详细级别。例如，我们将测试一台运行 ApacheWeb 服务器的机器。

首先，我们将运行`nmap -A`，然后将其作为`nmap -A -v`运行。长篇大论提供了更多的信息。首先，我们看到一个正常运行。它产生一些输出。这是测试整个网络的方法，因为它速度快，并生成一些有用的数据：

![The difference verbosity makes](../Images/image00688.jpeg)

随后的详细版本经过了轻微调整，以将所有细节都融入到图像中。当`-v`或`-vv`选项添加到搜索字符串时，不同的扫描选项具有不同的增强内容。当您使用基本显示选项选择了一些可能的目标时，使用`-v`或`-vv`是有意义的：

![The difference verbosity makes](../Images/image00689.jpeg)

根据在目标机器上运行的服务，`-v`和`-vv`可能会有很大的不同。在您尝试之前，您不会知道，因此如果您遇到一台提供有趣服务的机器，请务必尝试`-vv`：

![The difference verbosity makes](../Images/image00690.jpeg)

## 扫描网络范围

以下示例的网络范围为`192.168.202.0/24`，选择的扫描类型为无 ping 的强扫描。然后您点击**开始扫描**按钮，扫描运行。在扫描过程中，您将在屏幕上的**Nmap output**选项卡中看到输出。根据我们的扫描，网络上有六台活动主机。从 IP 地址旁边的图标可以看出，我们已经识别了两台 Windows 机器、两台 Linux 机器和两个未知的操作系统。

请注意，在命令文本框中，您将在命令行中使用字符串从命令行运行相同的扫描：

![Scanning a network range](../Images/image00691.jpeg)

如果网络已关闭 ICMP，尝试 ping 机器将花费大量时间。在目标机器上 ping UDP 端口所需的时间几乎与 ping 相同。无论哪种情况，每台机器每个端口大约需要 75 秒。在第一种情况下，这意味着 6 台机器的 ping 需要 450 秒才能通过 ping 测试。UDP 搜索测试每台机器的多个端口。在按照标准 UDP 端口扫描测试的`1000`端口上，每台机器大约需要 21 个小时来测试 UDP。如果您没有很好的理由使用 Nmap 检查 UDP 端口，那么这不是一个经济高效的做法。

通过点击**拓扑**选项卡，然后点击**主机查看器**按钮，您可以得到一个很好的主机列表。通过单击地址，您可以查看每个主机的详细信息。请注意，地址是不同的颜色。Nmap 为您挑选低垂的水果。绿色安全。黄色和红色具有可被利用的漏洞或服务：

![Scanning a network range](../Images/image00692.jpeg)

Zenmap 还有一个比较扫描的好功能。您将在**比较结果**下的菜单栏中找到它。在下面的屏幕截图中，您将看到我们在网络上运行了两次扫描。当我们比较两者时，在第二次扫描中发现了一台新机器。第一次扫描的结果用红色标记，`192.168.202.131`显示为向下。绿色显示为向上，并显示打开的端口和系统信息：

![Scanning a network range](../Images/image00693.jpeg)

开放端口和系统信息

下面是从命令行运行 Nmap 的结果。如前所述，Nmap 已移植到 Windows。如果您的公司允许，可以通过命令窗口中的命令行或通过 Windows Power Shell 在 Windows 系统上运行 Nmap：

![Scanning a network range](../Images/image00694.jpeg)

如果您有一个大型网络，并且只想找到 Windows 机器，您可以关注 Windows 漏洞，您可以运行快速扫描（`nmap -T4 -F 10.0.0.0/24`或快速扫描升级（`nmap -sV -T4 -O -F –version-light 10.0.0.0/24`）。这些将让你很好地了解你真正想要关注的机器。根据五个开放端口中的四个与 Windows 相关的事实，看起来`10.0.0.12`是一台 Windows 机器：

![Scanning a network range](../Images/image00695.jpeg)

当您查看**拓扑**时，您可以通过更改窗口底部控件的值来调整组的大小。图形的大小随着兴趣因子的增加而增大。标准视图将本地主机置于分组的中心，但如果单击其他主机之一，则会将其置于中心：

![Scanning a network range](../Images/image00696.jpeg)

使用拓扑更改控件的值

尽管 Zenmap 有一个简短的下拉列表列出了流行和有用的扫描，但您可以在定制扫描时使用各种各样的命令和选项。这是 Nmap 附带的帮助文件的视图，包括我们的注释。您可以在[的手册页面上找到更多信息 http://nmap.org/book/man](http://nmap.org/book/man) 。

# 在哪里可以找到关于这件事的说明？

在 Linux 机器上有三个地方可以找到有关命令行应用程序的更多信息：

*   **帮助页面**：几乎所有 Unix 和 Linux 应用程序都有一个帮助文件，您可以通过在命令行中键入应用程序名称和-h 来访问该文件，例如，`root@kali-01: ~# nmap -h`。
*   **手册页**：这是一本针对大多数现代命令行应用程序的完整手册，您可以通过在命令行上键入`man`和应用程序名称来访问该手册。例如，`root@kali-01: ~# man rsync`很好地解释了如何使用 Rsync，一种安全且记录的文件传输协议。手册页的质量参差不齐，许多手册页实际上是由火箭科学家编写的，因此新手可能需要研究如何阅读手册页，然后手册页才能发挥作用。Nmap 手册页清楚地写了一些可理解的示例以供试用。
*   **信息页面**：对于 BASH shell 内置，有一组信息页面而不是手册页面。要查看信息页面，请键入单词 info 和应用程序名称。例如，`root@kali-01: ~# info ls`将为您提供命令 ls 的信息页面，这是 DOS 命令 DIR 的 Linux 版本

`-h`命令选项会在终端窗口中为您显示内嵌文本，因此在信息滚动过去后，您会立即返回到命令提示符。man 和 info 命令启动文本阅读器 Less，因此您可以在文档上下滚动，即使您仍在终端窗口中。要退出 Less，只需按`q`键。

Shift 键是您在 Linux 终端仿真器中的朋友。如果您想在终端窗口中上下滚动，例如，如果-h 帮助文件比单个屏幕长，只需按住*Shift*+按住*向上*或*向下*光标键即可。复制粘贴的热键顺序分别为*Shift*+*Ctrl*+*C*和*Shift*+*Ctrl*+*V*。*Ctrl*+*C*关闭 Bash shell 中正在运行的应用程序，*Ctrl*+*V*什么也不做。

下表是 Nmap 中所有选项的截断列表。这与您从已安装在 Kali Linux 安装中的 Nmap 上的手动文件中获得的信息相同：

<colgroup><col> <col></colgroup> 
| 

用法：nmap[扫描类型][选项]{目标规范}

 |
| --- |
| **目标规格：****可以传递主机名、IP 地址、网络等****示例：atlantacloudtech.com，aarrggh.com/26192.168.3.111；10.1-16.0-255.1-254** |
| -iL“输入文件名” | 来自主机/网络列表的输入。 |
| -iR“num 主机” | 选择随机目标。 |
| --排除“主机 1[，主机 2][，主机 3]，…” | 排除主机/网络。 |
| --excludefile“exclude\u 文件 | 从文件中排除列表。 |
| **主机发现：** |
| -sL | 列表扫描-仅列出要扫描的目标。 |
| -锡 | Ping 扫描-禁用端口扫描。 |
| -Pn | 将所有主机视为在线主机；跳过主机发现的 ping。 |
| -PS[端口列表] | 指定端口的 TCP SYN 发现。 |
| -PA[端口列表] | 对给定端口的 TCP ACK 发现。 |
| -PU[端口列表] | UDP 发现到给定端口。 |
| -PY[端口列表] | 对给定端口的 SCTP 发现。 |
| -体育 | ICMP 回声发现探测器。 |
| -聚丙烯 | ICMP 时间戳发现探测。 |
| -首相 | ICMP 网络掩码请求发现探测。 |
| -采购订单[协议清单] | IP 协议 Ping，与 ICMP Ping 相反。 |
| -n | 从不进行 DNS 解析[默认：有时]。 |
| -R | 始终解决[默认值：有时]。 |
| **黑客提示：**解析 DNS 为您提供了有关网络的更多信息，但它会创建 DNS 请求流量，这会提醒系统管理员发生了不完全正常的事情，尤其是在网络中未使用 DNS 的情况下。 |
| --dns 服务器“serv1[，serv2]，…” | 指定自定义 DNS 服务器。 |
| --系统 dns | 使用操作系统的 DNS 解析程序。这是默认行为。 |
| --追踪路线 | 跟踪每个主机的跃点路径。这只有在大型、复杂、分段的网络中才有意义。 |
| **扫描技术：** |
| -党卫军 | TCP SYN 扫描（您将经常使用此扫描）。 |
| -圣 | TCP Connect（）扫描（您将经常使用此扫描）。 |
| -sA | TCP 确认扫描。 |
| -西南 | TCP 窗口扫描。 |
| -山猫 | TCP Maimon 扫描。 |
| -苏 | UDP 扫描。 |
| -锡 | TCP 空扫描。 |
| -科幻小说 | TCP FIN 扫描。 |
| -sX: | TCP Xmas 扫描。所有旗子都准备好了。混淆目标机器。 |
| --扫描标志“标志” | 自定义 TCP 扫描标志，包括下面 9 行中的标志。 |
| NS | ECN 暂时隐藏保护（实验性：见 RFC 3540）。 |
| 无缝线路 | 拥堵窗口减少。用于指示数据包的大小正在减小，以在拥挤的网络条件下维持流量。 |
| 欧洲经委会 | ECN Echo 具有双重作用，具体取决于 SYN 标志的值。它表明：如果设置了 SYN 标志（1），则表明 TCP 对等方支持 ECN。如果 SYN 标志清除（0），则在正常传输期间（通过 RFC 3168 添加到报头）接收到 IP 报头中设置有拥塞经历标志的数据包。 |
| 乌尔格 | 指示紧急指针字段有效。 |
| 阿克 | 表示确认字段有效。 |
| PSH | 推送功能。请求将缓冲数据推送到接收应用程序。 |
| RST | 重置连接。 |
| SYN | 同步序列号。 |
| 鳍 | 没有来自发件人的更多数据。 |
| -sI“僵尸主机[：probeport]” | 空闲扫描。 |
| -所以 | IP 协议扫描。 |
| -b“FTP 中继主机” | FTP 反弹扫描。 |
| **端口规格及扫描顺序：** |
| -p“端口范围” | 仅扫描指定端口，例如-p22-p1-65535-普：53111137，T:21-25801398080，S:9。 |
| -F | 快速模式-扫描的端口数少于默认扫描。 |
| -r | 连续扫描端口–不要随机化。 |
| --顶级端口“编号” | 扫描“编号”最常见的端口。 |
| --端口比率“比率” | 扫描比“比率”更常见的端口。 |
| **服务/版本检测：** |
| -sV | 探测打开的端口以确定服务/版本信息。 |
| --版本强度“级别” | 从 0（灯光）设置为 9（尝试所有探头）。 |
| --版本灯 | 限制最可能的探头（强度 2）。 |
| --版本全部 | 尝试每一个探头（强度 9）。 |
| --版本跟踪 | 显示详细的版本扫描活动（用于调试）。 |
| **脚本扫描：** |
| -sC | 等效于–script=默认值。 |
| --script=“Lua 脚本”： | “Lua 脚本”是以逗号分隔的目录、脚本文件或脚本类别列表，您可以在此处输入这些目录、脚本文件或脚本类别。 |
| --脚本 args=“n1=v1，[n2=v2，…” | 为脚本提供参数（或参数）。 |
| --脚本 args file=filename | 从文件中提供 NSE 脚本参数。 |
| --脚本跟踪 | 显示发送和接收的所有数据。 |
| --脚本更新 | 更新脚本数据库。 |
| --script help=“Lua 脚本” | 显示有关脚本的帮助。“Lua 脚本”是以逗号分隔的脚本文件或脚本类别列表。 |
| **操作系统检测：** |
| -O | 启用操作系统检测。 |
| --奥斯坎极限 | 将操作系统检测限制在有希望的目标上。 |
| --你能猜到吗 | 更积极地猜测操作系统。 |
| **定时和性能：****指定时间间隔的选项以秒为单位，或在值后面附加“毫秒”、“秒”、“分钟”或“小时”。例如 23ms）。** |
| -T“0-5” | 设置计时模板（越高速度越快，噪音也越大）。 |
| --最小主机组“大小” | 并行主机扫描组大小。 |
| --最大主机组“大小” | 并行主机扫描组大小。 |
| --最小平行度“numprobes” | 探针并行化。 |
| --最大平行度“numprobes” | 探针并行化。 |
| --最小 rtt 超时“时间” | 指定探测往返时间。 |
| --最大 rtt 超时“时间” | 指定探测往返时间。 |
| --初始 rtt 超时“时间” | 指定探测往返时间。 |
| --最大重试次数“尝试” | 限制端口扫描探针重新传输的次数。 |
| --主机超时“时间” | 在这个时间间隔后放弃目标。 |
| --扫描延迟“时间” | 调整探头之间的延迟。 |
| --最大扫描延迟“时间” | 调整探头之间的延迟。 |
| --最小速率“数” | 发送数据包的速度不低于每秒“数字”。 |
| --最大速率“数” | 发送数据包的速度不超过每秒“number”。 |
| **防火墙/IDS 规避和欺骗：** |
| -f--mtu“价值” | 片段数据包（可选带给定 MTU）。 |
| -D“诱饵 1，诱饵 2[，我]，” | 用诱饵掩盖扫描。 |
| -S“IP_ 地址” | 欺骗源地址。 |
| -e“iface” | 使用指定的接口。 |
| -g/--源端口“portnum” | 使用给定的端口号。 |
| --代理“url1、[url2]，…” | 通过 HTTP/SOCKS4 代理中继连接。 |
| --数据长度“数字” | 将随机数据附加到发送的数据包中。 |
| --ip 选项“选项” | 使用指定的 IP 选项发送数据包。 |
| --ttl“值” | 设置 IP 生存时间字段。 |
| --欺骗 mac“mac 地址/前缀/供应商名称” | 欺骗你的 MAC 地址。 |
| --巴德苏姆 | 使用伪 TCP/UDP/SCTP 校验和发送数据包。 |
| **输出：** |
| -关于“文件” | 以正常格式将扫描输出到给定文件名。 |
| -oX“文件” | 以 XML 格式将扫描输出到给定的文件名。 |
| -操作系统“文件” | 以 s &#124;“cript kIddi3 格式将扫描输出到给定的文件名。这只是为了好玩。 |
| -oG“文件” | 以可分级格式将扫描输出到给定文件名。 |
| -oA“基本名称” | 同时以三种主要格式输出。 |
| -五 | 将详细程度从 1-5 提高。使用-vv（详细程度 2）–vvv（详细程度 3）等以获得更大的效果。 |
| -d | 将调试级别提高到 0-6。您可以重复类似于“d”的详细级别，或者使用-d5 在命令行中节省空间。默认值为-d0。 |
| --理由 | 显示端口处于特定状态的原因。 |
| --打开 | 仅显示打开（或可能打开）的端口。 |
| --数据包跟踪 | 显示发送和接收的所有数据包。 |
| --iflist | 打印主机接口和路由（用于调试）。 |
| --日志错误 | 将错误/警告记录到正常格式输出文件中。 |
| --追加输出 | 附加到指定的输出文件，而不是删除指定的输出文件。 |
| --恢复“文件名” | 恢复中止的扫描。 |
| --样式表“路径/URL” | 将 XML 输出转换为 HTML 的 XSL 样式表。 |
| --webxml | 请参考 Nmap.org 中的样式表以了解更具可移植性的 XML。 |
| --没有样式表 | 防止将 XSL 样式表与 XML 输出关联。 |
| **杂项：** |
| -6 | 启用 IPv6 扫描。 |
| -A | 启用操作系统检测、版本检测、脚本扫描和跟踪路由。这是-sS-sV-traceroute-O 的快捷方式。Wolf 最喜欢的扫描选项。 |
| --datadir“dirname” | 指定自定义 Nmap 数据文件位置。 |
| --发送 eth | 使用原始以太网帧发送。 |
| --发送 ip | 使用原始 IP 数据包发送。 |
| --特权的 | 假设用户具有完全特权。 |
| --无特权 | 假设用户缺少原始套接字权限 |
| -五 | 打印 Nmap 版本号。不能与其他选项一起使用。 |
| -h | 打印帮助摘要页面。 |
| **示例：** |
| nmap-v-A boweaver.comnmap-v-sn 192.168.0.0/16 10.0.0.0/8nmap-v-iR 10000-Pn-p 80 |

### 提示

**黑客提示：**

您可以构造自定义 Nmap 扫描字符串并将其复制到 Zenmap 中，这样您就可以享受 Zenmap 接口的好处。

# 返回 OpenVAS

在[第一章](01.html#aid-F8902 "Chapter 1. Sharpening the Saw")*磨锯*中，我们设置了 OpenVAS 进行漏洞扫描。Nmap 在报告端口和服务方面做得很好，但缺乏扫描漏洞的能力。OpenVAS 将发现漏洞并生成系统报告。OpenVAS 每周更新其漏洞列表，因此最好在运行扫描之前更新 OpenVAS。要在 Kali 上执行此操作，请从终端窗口运行以下命令：

```
root@kalibook : ~ #  OpenVAS-nvt-sync

```

这将运行 OpenVAS 的漏洞更新。第一次运行它时，您将在下面的屏幕截图中看到要求迁移到使用 Rsync 更新漏洞的信息。输入 y 并按回车键。更新将启动。第一次运行它时，它将花费相当长的时间，因为它必须为您提供可用插件和测试的完整列表。在后续的 update 命令运行中，它只添加新的或更改的数据，速度要快得多：

![A return to OpenVAS](../Images/image00697.jpeg)

更新命令

您还需要运行以下命令：

```
root@kalibook : ~ #  OpenVAS-scapdata-sync

```

更新之后，我们就可以开始了。现在让我们启动 OpenVAS 服务。转到 OpenVAS 并单击**开始**按钮。终端窗口将打开，您将看到相关服务正在启动。启动后，您可以关闭此窗口并转到以下链接：`https://localhost:9392`。

### 提示

**您什么时候不使用 OpenVAS？**

在一些公司网络上，有扫描服务，可以用来扫描漏洞。除非您怀疑公司官方扫描工具未针对搜索范围进行正确配置，或者未更新以包含对最新漏洞的搜索，否则重复两次没有任何意义。Qualys、Nexpose 和 Nessus 等扫描服务都是很棒的扫描工具，可以完成与 OpenVAS 相同的任务。上述所有服务都将以 XML 格式导出数据，稍后可以将其导入 Metasploit 等工具。

现在使用您在[第 1 章](01.html#aid-F8902 "Chapter 1. Sharpening the Saw")、*磨锯*中选择的密码登录 OpenVAS web 界面。通常，用户是 admin。要运行第一次扫描，只需在扫描文本框中输入要扫描的机器的网络子网或单个 IP 地址，然后通过点击**开始扫描**按钮开始扫描。小极客女孩向导将为您设置几个正常参数并运行扫描。您还可以设置自定义扫描，甚至安排作业在给定日期和时间运行：

![A return to OpenVAS](../Images/image00698.jpeg)

设置自定义扫描和计划作业

一旦开始扫描，您将看到以下屏幕。大约一分钟后，您将看到它标记为 request，屏幕将刷新。现在您将看到进度条开始。取决于你扫描的网络有多大，你可以去喝杯咖啡，吃顿饭，明天再来，或者去度周末。这需要一段时间。值得注意的一点是，在整个过程中，您不需要靠得太近就可以单击**下一步**按钮：

![A return to OpenVAS](../Images/image00699.jpeg)

扫描完成

现在扫描已经完成，您将看到如下屏幕。进入**扫描管理**选项卡，然后进入下拉菜单中的**报告**。这将带您进入**报告**页面：

![A return to OpenVAS](../Images/image00700.jpeg)

报告页

**报告**页面将为您提供扫描结果，其中漏洞的严重性从最高到最低排序：

![A return to OpenVAS](../Images/image00701.jpeg)

“报告”页面上的扫描结果

从这里，您可以生成各种格式的报表。选择所需的格式，然后单击绿色向下箭头按钮：

![A return to OpenVAS](../Images/image00702.jpeg)

然后，您可以下载该报告。您可以对其进行编辑，使其具有您的公司徽标和文档中尚未包含的任何所需公司信息：

![A return to OpenVAS](../Images/image00703.jpeg)

# 使用 Maltego

**Maltego**是一款信息采集工具，除了采集网络信息外，还有很多用途。您还可以从各种来源收集有关人员和公司的信息。现在，我们将使用它来收集有关公共网络的网络信息。

第一次启动 Maltego 时，您需要进行一些设置，并在他们的网站上注册，以便登录到 Transform 服务器。它简单、免费、无垃圾邮件，所以给他们你的电子邮件地址不会有问题。注册后，系统将要求您选择所需的搜索级别。在本例中，我们选择了一个级别 1 搜索。Maltego 然后请求域，如下面的屏幕截图所示。添加域名，点击**完成**按钮。转换将运行并检索以下信息：

![Using Maltego](../Images/image00704.jpeg)

检索信息

选择 Maltego 公共服务器复选框代替本地**转换应用服务器**（**TAS**）：

![Using Maltego](../Images/image00705.jpeg)

选择您的目标域。这里我们选择了[www.bowaver.com](http://www.boweaver.com)域。您需要为此步骤选择您拥有或控制的域：

![Using Maltego](../Images/image00706.jpeg)

选择域名

以下屏幕截图中的级别 1 扫描显示了目标域名以及相关网站、为该站点提供服务的计算机和解析该域的 DNS 服务器：

![Using Maltego](../Images/image00707.jpeg)

查看目标域名

这是一个不错的开始，但我们确实想了解更多信息，所以我们右键点击网站[www.boweaver.com](http://www.boweaver.com)并进入转换列表。我们将使用技术转换运行 Resolve to IP Build，以查找运行的服务类型和站点的 IP 地址：

![Using Maltego](../Images/image00708.jpeg)

运行的服务类型和 IP 地址

我们可以看到 IP 地址是`164.243.238.98`，站点运行的操作系统是 Debian，web 服务器是 Apache2.2，站点框架是 PHP：

![Using Maltego](../Images/image00709.jpeg)

当我们点击**实体列表**选项卡时，我们会得到一个信息节点列表：

![Using Maltego](../Images/image00710.jpeg)

双击一个图标，你会看到一个**详细信息**窗口。在这里，您可以在节点上保留注释，附加相关文件，并执行多个搜索，例如 Google 和 Wikipedia：

![Using Maltego](../Images/image00711.jpeg)

使用 Pro 版本，您可以生成地图的报告和图表。对于每个节点的搜索，社区版本也限制为 12 个节点。

Maltego 可用于汇编所有笔记，并从渗透测试中收集数据。您还可以在 Kali 上找到一个名为 Casefile 的应用程序。**案例文件**是 Maltego 的离线版本，用于存储和编译安全工作中的数据。

您可以在[在线找到这些应用程序的 Windows 版本 http://www.paterva.com](http://www.paterva.com) 。请访问他们的网站，了解其应用程序的更深入使用情况。看看这个工具如何也可以用于社会工程。

# 使用独角兽扫描

**独角兽扫描**是另一种端口扫描工具。它创建了一个 chrooted 环境（userland），以保护您免受您正在扫描的可能存在的恶意网络的攻击。它可以从命令行使用，也可以从支持 PostgreSQL 的前端使用。我们将在这里向您展示命令行版本。下图是 Nmap 用户从 Unicorn Scan 项目网站上的文档中获得的一致性：

![Using Unicorn-Scan](../Images/image00712.jpeg)

使用 Unicorn 扫描查找范围内所有打开端口的基本连接扫描为`unicornscan -i eth0 -Ir 160 -E 10.0.0.012/32:20-600`。如果我们将其分解为多个部分，则命令如下：

*   `i eth0`：定义 Kali 机器上的 eth0 接口
*   `-Ir 160`：Its 在

    *   `-I`组中有两个选项：当发现打开的端口时，它告诉 Unicorn Scan 立即打印到屏幕
    *   `-r 160`：它将扫描速率设置为每秒 160 个端口（PPS）

*   `-E 10.0.0.012/32:20-600`：目标范围
*   **无类域间路由**（**CIDR**代码显示了一个`/32`位的网络掩码，表示一个 IP 地址
*   端口范围从`20`到`600`：

![Using Unicorn-Scan](../Images/image00713.jpeg)

与`-vvvv`相同扫描的极其详细的版本为您提供了更多信息。`Proto 6`为 TCP 协议，`Proto 17`为 UDP 协议。极其详细的版本正在为端口`80`（TCP）处可能的 web 服务器和几个预期的 UDP 设置加载测试：端口`53`处的 DNS；端口`5060`的 SIP 协议；端口`1900`处的微软**简单服务发现协议**（**SSDP**）；和 Talkd，一种允许两个用户登录到同一台机器的服务，例如在端口`518`上两个人被炮击到同一个服务中时存在的情况：

![Using Unicorn-Scan](../Images/image00714.jpeg)

### 提示

**黑客提示**

这里有一个关于笔记的词！笔式测试收集大量数据，即使在小型网络上也是如此。我是说很多！因此，当笔测试时，您需要能够在测试时收集传入数据。

Kali 在中提供了几个应用程序。无论你选择哪一个，选择它并使用它。如果您需要在测试运行六周后返回以验证某些内容，您会很高兴您这样做了。此外，在测试高安全性环境（如必须符合 HIPPA 或 PCI 的网络）时，这些说明在认证过程中非常有用。使用相同的框架将所有项目文件保存在一个目录中。此外，你的作品有可能被法庭用来起诉你的客户、第三方或你自己。在后一种情况下，你的笔记是你唯一的辩护理由。以下是我们使用的框架：

1.  为客户组织创建一个文件夹。
2.  然后为实际测试创建一个文件夹，文件夹名称中包含日期。可以放心地假设，无论你在哪里交易，你都会一次又一次地看到相同的客户。如果你没有看到重复经营，那么你自己的商业模式就出了问题。`ext-20150315`翻译为 2015 年 3 月 15 日进行的外部测试。20150315 是一个 Unix 日期，该日期突然变为`YYYY/MM/DD`。如果您看到 Unix 日期戳看起来像`20150317213209`，则可以分解为第二个。
3.  Inside of that folder, set up evidence, notes, and scans-docs directories. All evidence collected and screenshots are dropped into the evidence folder. Notes from KeepNote are kept in the notes folder, and scans and other related documents are kept in the scans-docs folder. When we start conducting tests later in this book, you will see this framework being used:

    ![Using Unicorn-Scan](../Images/image00715.jpeg)

即使你只为一家公司工作，也要将每个测试的数据分开并注明日期。这将有助于跟踪您的测试。

对于实际的笔记，Kali 附带了几个应用程序。Maltego 就是这些工具之一，能够将所有数据保存在一个地方。作者最喜欢的是 KeepNote 和 Maltego。您在[第一章](01.html#aid-F8902 "Chapter 1. Sharpening the Saw")中看到了 KeepNote 的介绍，*磨锯*。KeepNote 是一个简单的笔记应用程序。在运行测试时，保留手动漏洞利用、单个扫描数据和屏幕截图的输出副本。这样做的好处是，您能够在运行时格式化数据，因此以后将其导入模板只需复制和粘贴即可。下一张图片是 Keepnote 的绝佳设置：

![Using Unicorn-Scan](../Images/image00716.jpeg)

请注意项目注释页面中的项目一般注释，以及目标文件夹下的各个页面中的每个被测试机器的注释。

# 使用 Htop 监控资源使用

我们经常添加到 Kali 中的一个很棒的工具是 htop。**Htop**是一个类似于 Windows 任务管理器的命令行工具。了解内存、交换文件、CPU、周期和 IOPS 的使用率非常重要。Htop 允许您使用鼠标按任何类别进行排序，这意味着扫描性能的提高。这与 Top 工具提供的信息相同，但作为一个 ncurses 应用程序，它提供了更现代的 GUI 风格，而无需使用大量资源来显示资源数据。对于下图，我们开始了长扫描`nmap -A 100.0.0.0/8`。Iceweasel 系列是 Firefox 的 Debian/Kali 全自由软件版本，与 Firefox 具有相同的内存占用行为。Nmap 扫描占用大量 CPU 周期，而不是太多内存：

![Monitoring resource use with Htop](../Images/image00717.jpeg)

# 在网络上胡闹

网络扫描器 EtherApe 是您可能希望安装在黑客信箱上的另一个工具。它以图形方式显示网络上使用的协议。在下面的图片中，`10.0.0.4`是卡利黑盒子。所有其他端点都是内部和外部主机。协议列表在左侧向上运行：

![Monkeying around the network](../Images/image00718.jpeg)

当您运行 EtherApe 时，您可以真正看到端口扫描的噪音有多大。您还可以看到其他惊喜，例如人们下载大型文件，如音乐和电影。移动的数据越大，行越大。下图中的大型太阳物体是文件下载的来源，而到 hackbox 的三角形飞行路径显示了目标机器：

![Monkeying around the network](../Images/image00719.jpeg)

# 总结

我们向您展示了一些用于发现目标网络范围的工具。我们每周都使用这些工具中的大部分。前三个，Nmap、Zenmap 和 OpenVAS，每天都在使用。Maltego 和 KeepNote 可以帮助你整理证据。Unicorn 扫描是 Nmap 的一个有趣的替代方案。EtherApe 实际上是一种工具，您可以将其用作网络中发生的事情的图形显示。只需在带有输出屏幕的实用程序盒上运行它，您就可以看到它。在 IPS 发送警报之前，您将能够看到流量问题。如果您在进行过程中一直在尝试，那么您应该能够对网络进行完整而准确的概述，并且能够开始针对任何网络中的特定机器进行攻击。

在下一章中，我们将学习如何使用工具利用几个常见的 windows 漏洞，以及如何为即将出现的漏洞创建和实施新的漏洞利用方法。